<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Transaksi Mini-ATM | Amko MiniLink</title>
  <style>
    :root{
      --navy1:#0b2a5b; --navy2:#123b7a;
      --bg:#f3f6fb; --card:#ffffff; --txt:#0f172a;
      --border:#e6ebf3; --shadow:0 6px 18px rgba(2,8,23,.06);
      --sidebar-w:260px; --H_BAR:48px;

      
      --kpi-blue:#1976d2;   
      --kpi-green:#2e7d32;  
      --kpi-amber:#ffb300;  
      --kpi-orange:#fb8c00; 
      --kpi-profit:#43a047; 
      --kpi-brown:#99501d;  

      
      --chip1:#6f3bf1; --chip2:#7a4df3;

      
      --modal-bg:#f9fafb;
      --fade-in: fadeIn .28s ease forwards;

      
      --loading-backdrop: rgba(2,6,23,.35);
      --loading-card-bg: #ffffff;
    }

    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-8px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    @keyframes pulseSoft {
      0% { transform: scale(1); box-shadow: 0 8px 26px rgba(0,0,0,.06); }
      50%{ transform: scale(1.02); box-shadow: 0 12px 30px rgba(0,0,0,.10); }
      100%{ transform: scale(1); box-shadow: 0 8px 26px rgba(0,0,0,.06); }
    }
    @keyframes spinner {
      to { transform: rotate(360deg); }
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--txt);
      font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;
    }

    
    .layout{display:grid;grid-template-columns:var(--sidebar-w) 1fr;min-height:100vh}

    
    .sidebar{
      position:sticky; top:0; height:100vh; z-index:10001;
      background:linear-gradient(180deg,var(--navy1),var(--navy2));
      color:#eaf2ff; display:flex; flex-direction:column; box-shadow:var(--shadow);
    }
    .brand{display:flex;align-items:center;gap:10px;padding:16px 18px;border-bottom:1px solid rgba(255,255,255,.08);font-weight:800}
    .nav{padding:10px}
    .nav a{
      display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;
      color:#eaf2ff;text-decoration:none;font-weight:600;transition:all .18s ease;
    }
    .nav a:hover,.nav a.active{background:rgba(255,255,255,.10);transform:translateX(2px)}
    .group{margin-top:12px;border:1px solid rgba(255,255,255,.10);border-radius:10px;overflow:hidden;transition:box-shadow .18s ease}
    .group:hover{box-shadow:0 4px 16px rgba(0,0,0,.12)}
    .group-header{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;background:rgba(255,255,255,.06);cursor:pointer}
    .group-body{padding:8px;display:flex;flex-direction:column;gap:4px}
    .group.collapsed .group-body{display:none}
    .footer{margin-top:auto;padding:12px}
    .logout{
      width:100%;border:0;border-radius:10px;background:#ef4444;color:#fff;
      padding:10px 12px;font-weight:800;text-align:center;text-decoration:none;display:block;
      transition:all .18s ease;
    }
    .logout:hover{background:#dc2626;transform:scale(1.03);box-shadow:0 6px 18px rgba(220,38,38,.35)}

    
    .branchbar{
      position:sticky; top:0; z-index:55; min-height:var(--H_BAR);
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      padding:10px 16px; background:#fff; border-bottom:1px solid var(--border);
      backdrop-filter: saturate(180%) blur(3px);
    }
    .bb-select{min-width:260px;height:38px;border:1px solid var(--border);border-radius:10px;padding:0 10px;background:#fff;font-weight:700;transition:box-shadow .18s ease}
    .bb-select:focus{box-shadow:0 0 0 3px rgba(29,78,216,.15)}
    .bb-now{font-weight:800;background:#eef2ff;border:1px solid var(--border);border-radius:999px;padding:6px 10px}
    .user-role{margin-left:auto;font-weight:900;color:#1e293b}
    .hamburger{display:none;place-items:center;width:38px;height:38px;border-radius:10px;border:1px solid var(--border);background:#fff;transition:all .18s ease}
    .hamburger:hover{transform:scale(1.05);box-shadow:0 6px 18px rgba(0,0,0,.08)}

    
    .ticker{
      background:#2a44a5; color:#eaf2ff;
      border-bottom:2px solid #1e2f84;
      overflow:hidden; position:relative; padding:18px 0;
      --ticker-gap: 20px;
      --ticker-speed: 16s;
      --ticker-shift: 200px;
    }
    .ticker-rail{
      display:flex; align-items:center; width:max-content; will-change:transform;
      gap:var(--ticker-gap);
      animation: ticker-marquee var(--ticker-speed) linear infinite;
    }
    .ticker-chunk{ white-space:nowrap; font-weight:600; letter-spacing:.2px; font-size:18px }
    @keyframes ticker-marquee{
      from{ transform:translateX(0) }
      to  { transform:translateX(calc(-1 * var(--ticker-shift))) }
    }
    @media (prefers-reduced-motion: reduce){ .ticker-rail{ animation:none } }

    
    .grid{display:grid;grid-template-columns:1fr;gap:14px;margin:14px 18px}
    .card{
      background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);padding:14px;
      transition: box-shadow .18s ease, transform .18s ease;
    }
    .card:hover{ box-shadow:0 10px 26px rgba(2,8,23,.08); transform:translateY(-1px) }
    .card h3{margin:0 0 10px 0}

    
    .kpi-grid{
      display:left-grid;
      grid-template-columns:repeat(6,1fr);
      gap:20px;
    }
    .kpi{
      border-radius:16px;box-shadow:var(--shadow);padding:16x 18px;
      color:#fff; display:flex; gap:14px; align-items:center; min-height:76px;
      transition:transform .18s ease, box-shadow .18s ease;
    }
    .kpi:hover{ transform:translateY(-2px); box-shadow:0 14px 60px rgba(0,0,0,.12) }
    .kpi .ic{
      width:40px;height:40px;border-radius:12px;display:grid;place-items:center;
      background:rgba(255,255,255,.18);font-weight:900;font-size:18px
    }
    .kpi .meta{display:flex;flex-direction:column}
    .kpi .meta h4{margin:0;font-size:40px;color:#fff;letter-spacing:.1px}
    .kpi .meta .val{font-weight:900;font-size:18px;line-height:1.5}

    .kpi.blue   {background:linear-gradient(180deg,var(--kpi-blue),#155a9b)}
    .kpi.green  {background:linear-gradient(180deg,var(--kpi-green),#205b24)}
    .kpi.amber  {background:linear-gradient(180deg,var(--kpi-amber),#c08a00)}
    .kpi.orange {background:linear-gradient(180deg,var(--kpi-orange),#d27100)}
    .kpi.profit {background:linear-gradient(180deg,var(--kpi-profit),#2e6f33)}
    .kpi.brown  {background:linear-gradient(180deg,var(--kpi-brown),#6b3512)}

    
    .asset-main{display:flex;align-items:center;justify-content:space-between;background:#fff;border:1px solid var(--border);border-radius:16px;padding:12px 16px;box-shadow:var(--shadow)}
    .asset-label{font-size:12px;font-weight:800;color:#334155}
    .asset-value{font-size:20px;font-weight:900;color:#16a34a}

    
    #kpiSaldoWrap{
      display:flex !important; gap:10px !important; overflow-x:auto !important; overflow-y:hidden !important;
      padding:8px 6px 10px !important; scroll-snap-type:x mandatory !important; -webkit-overflow-scrolling:touch !important;
      border-radius:16px !important; background:#fff !important; border:1px solid var(--border) !important; box-shadow:var(--shadow) !important;
    }
    #kpiSaldoWrap > .kpi-card{
      flex:0 0 auto !important; min-width:210px !important; max-width:260px !important; scroll-snap-align:start !important;
      border-radius:999px !important; padding:10px 16px !important;
      background:linear-gradient(180deg,var(--chip1),var(--chip2)) !important; color:#fff !important;
      border:0 !important; display:flex !important; align-items:center !important; justify-content:space-between !important;
      box-shadow:var(--shadow) !important; transition:transform .18s ease, box-shadow .18s ease;
    }
    #kpiSaldoWrap > .kpi-card:hover{ transform:translateY(-2px); box-shadow:0 14px 30px rgba(0,0,0,.12) }
    #kpiSaldoWrap .kpi-title{color:#fff !important;font-weight:800 !important}
    #kpiSaldoWrap .kpi-value{color:#fff !important}

    
    .filters{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:10px 0}
    .sel,.date-input{height:38px;padding:0 10px;border:1px solid var(--border);border-radius:10px;background:#fff;font-weight:700;transition:box-shadow .18s ease}
    .sel:focus,.date-input:focus{box-shadow:0 0 0 3px rgba(29,78,216,.15)}
    .btn-sm{
      height:38px;padding:0 12px;border-radius:10px;font-weight:800;cursor:pointer;border:1px solid var(--border);background:#fff;
      transition:transform .18s ease, box-shadow .18s ease, background .18s ease, border-color .18s ease, color .18s ease;
    }
    .btn-sm:hover{transform:translateY(-1px);box-shadow:0 8px 22px rgba(0,0,0,.10)}
    .btn-primary{background:#1d4ed8;color:#fff;border-color:#1d4ed8}
    .btn-ghost{background:#f1f5f9}
    .btn-danger{background:#fee2e2;color:#991b1b;border-color:#fee2e2}
    .btn-wa{background:#15803d;color:#fff;border-color:#15803d}
    .btn-excel{background:#0ea5e9;color:#fff;border-color:#0ea5e9}
    .btn-sm:disabled{opacity:.5;cursor:not-allowed;transform:none;box-shadow:none}

    
    .modal{
      position:fixed;inset:0;background:rgba(2,6,23,.45);
      display:none;align-items:center;justify-content:center;
      padding:12px;z-index:100;
    }
    .modal.show{display:flex;animation:var(--fade-in)}
    .dialog{
      width:min(1024px,100%);
      background:var(--modal-bg);
      border-radius:16px;border:1px solid var(--border);
      overflow:hidden;box-shadow:0 12px 30px rgba(0,0,0,.18);
      display:flex;flex-direction:column;max-height:92vh
    }
    .dlg-hd{background:#0ea5e9;color:#fff;padding:12px 16px;font-weight:800;display:flex;justify-content:space-between;align-items:center}
    .dlg-bd{padding:14px;display:grid;gap:12px;overflow:auto}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    label{font-size:12px;color:#475569;margin-bottom:6px;display:block}
    .icon-input{display:flex;gap:8px;align-items:center;border:1px solid var(--border);border-radius:12px;padding:12px;background:#fff;min-height:50px}
    .icon-input input,.icon-input select,.icon-input textarea{border:none;outline:none;flex:1;font-size:16px;background:transparent}
    .icon-input textarea{min-height:96px;resize:vertical}
    .dlg-ft{position:sticky;bottom:0;background:#fff;border-top:1px solid var(--border);padding:12px 16px;display:flex;gap:8px;justify-content:flex-end}

    
    table{width:100%;border-collapse:separate;border-spacing:0;min-width:1100px;background:#fff}
    thead th{
      position:sticky;top:0;background:#eef2ff;border-bottom:1px solid var(--border);
      padding:12px;font-size:13px;text-align:left;color:#1f2937;z-index:2;
      box-shadow: 0 1px 0 rgba(0,0,0,.03);
    }
    tbody td{border-bottom:1px solid var(--border);padding:10px 12px}
    tbody tr:hover{background:#f8fafc}


table { border-collapse: collapse !important; }
th, td { border: 1px solid var(--border) !important; }

    
    @media (max-width: 980px) {
      table { font-size: 12px; min-width: 1100px; }
      thead th, tbody td { padding: 6px 8px; }
      .card > div[style*="overflow:auto"] {
        overflow-x: auto !important;
        -webkit-overflow-scrolling: touch;
        scroll-behavior: smooth;
      }
    }

    
    @media (max-width:980px){
      .dialog{ width:75%; max-width:480px; border-radius:14px; }
      .dlg-hd{font-size:15px;padding:10px 14px}
      .dlg-bd{padding:10px;gap:8px}
      .dlg-ft{padding:10px 14px}
      label{font-size:12.5px}
      .icon-input{padding:10px;min-height:44px}
      .icon-input input,.icon-input select,.icon-input textarea{font-size:14px}
      .btn-sm{font-size:13px;height:36px}
      .row{grid-template-columns:1fr}
    }

    
    .loading-overlay{
      position:fixed; inset:0; display:none; align-items:center; justify-content:center; z-index:9998;
      background: var(--loading-backdrop); backdrop-filter: blur(2px);
    }
    .loading-overlay.show{ display:flex; animation: fadeIn .22s ease }
    .loading-card{
      background:var(--loading-card-bg); border-radius:16px; padding:14px 16px; border:1px solid var(--border);
      box-shadow: 0 14px 32px rgba(0,0,0,.18); display:flex; align-items:center; gap:12px;
      animation: pulseSoft 1.2s ease-in-out infinite;
    }
    .spinner{
      width:22px; height:22px; border-radius:50%;
      border:3px solid #cbd5e1; border-top-color:#1d4ed8; animation: spinner .8s linear infinite;
    }
    .loading-text{ font-weight:800; color:#1e293b }
    .loading-sub{ font-size:12px; color:#475569 }
    
    
    @media (max-width:980px){
      .card > div[style*="overflow"] {
        overflow-x: auto !important;
        -webkit-overflow-scrolling: touch !important;
        display: block !important;
        width: 100% !important;
      }
      .card > div[style*="overflow"] > table {
        min-width: 1100px !important;
        width: 1100px !important;
        white-space: nowrap !important;
      }
      .card > div[style*="overflow"]::-webkit-scrollbar { height: 10px; }
      .card > div[style*="overflow"]::-webkit-scrollbar-thumb { background: #9ca3af; border-radius: 5px; }
      .card > div[style*="overflow"]::-webkit-scrollbar-track { background:#f1f5f9; }
    }

    
    @media (max-width:1080px){ .kpi-grid{grid-template-columns:repeat(3,1fr)} }
    @media (max-width:2200px){
      .layout{grid-template-columns:1fr}
      .sidebar{position:fixed;left:calc(-1 * var(--sidebar-w));top:0;bottom:0;width:var(--sidebar-w);border-right:1px solid rgba(255,255,255,.12)}
      .sidebar.open{left:0}
      .hamburger{display:grid}
      .row{grid-template-columns:1fr}
      .kpi-grid{grid-template-columns:repeat(2,1fr)}
      .kpi{min-height:72px;padding:12px}
      .kpi .meta .val{font-size:17px}
    }
    @media (max-width:420px){
      .kpi-grid{grid-template-columns:1fr}
      .kpi .meta .val{font-size:16px}
      .branchbar .bb-now{font-size:13px;padding:4px 8px}
    }
  
thead th {
  color: #b91c1c !important;
  font-weight: 700 !important;
}

.toast {
  position: fixed;
  bottom: 24px;
  right: 24px;
  background: #16a34a;
  color: #fff;
  padding: 12px 18px;
  border-radius: 12px;
  font-weight: 700;
  box-shadow: 0 8px 24px rgba(0,0,0,.18);
  opacity: 0;
  transform: translateY(20px);
  transition: all .3s ease;
  z-index: 9999;
}
.toast.show {
  opacity: 1;
  transform: translateY(0);
}
.toast.error {
  background: #dc2626;
}



@media (max-width: 980px) {
  .filters {
    flex-direction: column !important;
    align-items: stretch !important;
    gap: 6px !important;
    margin-top: 4px !important;
    margin-bottom: 10px !important;
    width: 100% !important;
    padding-left: 8px !important;
    padding-right: 8px !important;
    box-sizing: border-box !important;
  }
  .filters .sel,
  .filters .date-input,
  .filters .btn-sm {
    width: 100% !important;
  }
  .filters button {
    height: 42px !important;
    font-size: 14px !important;
  }

  
  #btnWA { order: 1; background:#15803d !important; color:#fff !important; border-color:#15803d !important; }
  #btnExport { order: 2; background:#0ea5e9 !important; color:#fff !important; border-color:#0ea5e9 !important; }
  #btnTambah { order: 3; background:#1d4ed8 !important; color:#fff !important; border-color:#1d4ed8 !important; }

  
  .card {
    padding: 10px !important;
    border-radius: 14px !important;
    margin-left: 8px !important;
    margin-right: 8px !important;
  }
  #totalTransaksi {
    margin-top: 8px !important;
    margin-bottom: 4px !important;
    font-size: 13px !important;
  }
  table {
    font-size: 12px !important;
  }

  
  .grid {
    overflow-x: hidden !important;
  }
}



@media (max-width:980px){
  
  #kpiSaldoWrap {
    overflow-x: auto !important;
    display: flex !important;
    gap: 10px !important;
    padding-bottom: 8px !important;
    padding-left: 8px !important;
    padding-right: 8px !important;
  }
  #kpiSaldoWrap::-webkit-scrollbar {
    height: 6px;
  }
  #kpiSaldoWrap::-webkit-scrollbar-thumb {
    background: rgba(0,0,0,0.3);
    border-radius: 10px;
  }
  .kpi-card {
    flex: 0 0 auto;
    min-width: 160px !important;
    scroll-snap-align: start;
  }

  
  .table-wrapper {
    overflow-x: auto !important;
    -webkit-overflow-scrolling: touch !important;
    display: block !important;
    width: 100% !important;
    margin-left: 8px !important;
    margin-right: 8px !important;
  }
  .table-wrapper table {
    min-width: 1100px !important;
  }
  .table-wrapper::-webkit-scrollbar {
    height: 8px;
  }
  .table-wrapper::-webkit-scrollbar-thumb {
    background: rgba(0,0,0,0.25);
    border-radius: 10px;
  }
}



.form-grid {
  display: grid;
  gap: 8px;
}
.form-grid label {
  font-size: 0.9rem;
  color: #0f172a;
  margin-bottom: 2px;
}
.form-grid input, .form-grid select {
  padding: 6px 10px;
  border: 1px solid #cbd5e1;
  border-radius: 6px;
  font-size: 0.9rem;
}
.form-grid input:focus, .form-grid select:focus {
  outline: 2px solid #3b82f6;
  border-color: #3b82f6;
}
.modal-content form {
  display: grid;
  gap: 10px;
  padding: 8px 12px;
}
</style>

<style id="v7-compact">

:root{
  --primary:#2274e0;
  --label:#666;
}

.modal { background: rgba(0,0,0,0.35); }

.modal .dialog {
  max-width: 480px;
  width: calc(100% - 24px);
  border-radius: 14px;
  box-shadow: 0 12px 28px rgba(0,0,0,0.25);
  transform: scale(0.95);
  opacity: 0;
  transition: transform .18s ease, opacity .18s ease;
}
.modal.show .dialog { transform: scale(1); opacity: 1; }


.dlg-hd{
  background: var(--primary);
  color:#fff;
  padding:10px 14px;
  border-top-left-radius:14px;
  border-top-right-radius:14px;
  display:flex; align-items:center; justify-content:space-between;
  font-weight:600;
}
.dlg-hd span { display:flex; align-items:center; gap:8px; font-size:14px; }


.dlg-bd{ padding:12px 14px; }

.dlg-bd .row{ display:grid; grid-template-columns: 1fr 1fr; gap:8px; margin-bottom:8px; }
@media (max-width: 600px){
  .dlg-bd .row{ grid-template-columns: 1fr; }
}


.dlg-bd .row > div{
  position: relative;
  padding-top: 14px; 
}


.dlg-bd .row > div > label{
  position:absolute;
  top: 18px;
  left: 10px;
  font-size: 12px;
  color: var(--label);
  pointer-events:none;
  transition: all .2s ease;
  background: transparent;
  padding: 0 2px;
}


.dlg-bd .row .icon-input,
.dlg-bd .row .icon-input select,
.dlg-bd .row .icon-input input{
  font-size:13px;
}
.dlg-bd .row .icon-input{
  display:block;
  background:#fff;
  border:1px solid #d7d7d7;
  border-radius:8px;
  padding: 6px 10px;
  transition: border-color .2s ease, box-shadow .2s ease;
}
.dlg-bd .row .icon-input:focus-within{
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(34,116,224,0.12);
}
.dlg-bd .row .icon-input input,
.dlg-bd .row .icon-input select{
  width:100%;
  outline:none;
  border:none;
  background:transparent;
  padding:2px 0;
}


.dlg-bd .row > div.filled > label,
.dlg-bd .row > div:focus-within > label{
  top: 2px;
  left: 8px;
  font-size: 10px;
  color: var(--primary);
  background: #fff;
}


#labelNominal { 
  visibility:hidden; height:0; margin:0; padding:0;
}


#rowAdminLuarOnly .icon-input { padding:6px 10px; }


.btn, .btn-sm, .btn-primary{
  border-radius:10px;
}
.btn-primary{
  background: var(--primary);
  color:#fff;
  border: none;
}
.btn-primary:hover{ filter: brightness(0.95); }


.dlg-ft{ padding:10px 14px; display:flex; justify-content:flex-end; gap:8px; }


@media (max-width: 420px){
  .modal .dialog{ width: calc(100% - 16px); }
  .dlg-bd{ padding:10px 12px; }
  .dlg-hd{ padding:9px 12px; }
  .dlg-ft{ padding:9px 12px; }
}


.form-grid {
  display: grid;
  gap: 8px;
}
.form-grid label {
  font-size: 0.9rem;
  color: #0f172a;
  margin-bottom: 2px;
}
.form-grid input, .form-grid select {
  padding: 6px 10px;
  border: 1px solid #cbd5e1;
  border-radius: 6px;
  font-size: 0.9rem;
}
.form-grid input:focus, .form-grid select:focus {
  outline: 2px solid #3b82f6;
  border-color: #3b82f6;
}
.modal-content form {
  display: grid;
  gap: 10px;
  padding: 8px 12px;
}
</style>



<style>
:root { --accent: #2196f3; } 

@media (prefers-color-scheme: dark) {
  #modalForm {
    --bg: #1b1d1f;
    --text: #eaeaea;
    --input-bg: #2a2d31;
  }
}
@media (prefers-color-scheme: light) {
  #modalForm {
    --bg: #ffffff;
    --text: #222;
    --input-bg: #f9f9f9;
  }
}


#modalForm {
  color: var(--text);
  font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
}
#modalForm .dlg, #modalForm .modal, #modalForm .dialog {
  background: var(--bg);
  border-radius: 12px;
  box-shadow: 0 8px 28px rgba(0,0,0,0.22);
}


#modalForm input, 
#modalForm select, 
#modalForm textarea {
  background: var(--input-bg);
  color: var(--text);
  border: none;
  border-bottom: 2px solid var(--accent);
  border-radius: 8px 8px 0 0;
  padding: 10px 12px;
  transition: box-shadow .2s ease, border-color .2s ease, background .2s ease;
  width: 100%;
  outline: none;
}
#modalForm input:focus, 
#modalForm select:focus, 
#modalForm textarea:focus {
  box-shadow: 0 2px 0 0 var(--accent), 0 0 0 2px color-mix(in oklab, var(--accent) 20%, transparent);
}


#modalForm label {
  font-weight: 600;
  opacity: .92;
}


#modalForm button, 
#modalForm .btn-primary {
  background: var(--accent);
  color:#fff;
  border: none;
  border-radius: 10px;
  padding: 10px 16px;
  cursor: pointer;
  transition: transform .15s ease, opacity .2s ease, background .2s ease;
}
#modalForm button:hover, 
#modalForm .btn-primary:hover {
  transform: translateY(-1px);
  opacity: .95;
}


@keyframes v25_fadeInScale {
  0% { opacity: 0; transform: scale(.96); }
  100% { opacity: 1; transform: scale(1); }
}
#modalForm.show .dlg, 
#modalForm.show .modal, 
#modalForm.show .dialog {
  animation: v25_fadeInScale .25s ease-out;
}


#modalForm #rowSumber,
#modalForm #rowAdminDua,
#modalForm #rowPulsa {
  gap: 12px;
}
#modalForm .row, 
#modalForm [class*='row'] {
  margin-bottom: 10px;
}
</style>



<style>
:root { --accent: #2196f3; }


#modalForm { font-family: "Inter", system-ui, -apple-system, Segoe UI, Roboto, sans-serif; }


#modalForm .v26-field { position: relative; margin-top: 18px; }


#modalForm .v26-field input,
#modalForm .v26-field select,
#modalForm .v26-field textarea {
  width: 100%;
  padding: 12px 10px 6px 10px;
  font-size: 14px;
  color: var(--text, #222);
  background: transparent;
  border: none;
  border-bottom: 2.5px solid var(--accent);
  outline: none;
  transition: border-color .2s ease, box-shadow .2s ease, background .2s ease;
  border-radius: 8px 8px 0 0;
}


#modalForm .v26-field input:focus,
#modalForm .v26-field select:focus,
#modalForm .v26-field textarea:focus {
  box-shadow: 0 0 0 3px color-mix(in srgb, var(--accent) 28%, transparent);
}


#modalForm .v26-field > label {
  position: absolute;
  top: 13px;
  left: 10px;
  font-size: 14px;
  color: var(--text, #222);
  opacity: 0.7;
  pointer-events: none;
  transition: all .15s ease;
}
#modalForm .v26-field:has(input:focus) > label,
#modalForm .v26-field:has(select:focus) > label,
#modalForm .v26-field:has(textarea:focus) > label,
#modalForm .v26-field:has(input:not(:placeholder-shown)) > label,
#modalForm .v26-field:has(textarea:not(:placeholder-shown)) > label,
#modalForm .v26-field:has(select[data-hasvalue="1"]) > label {
  top: -6px;
  left: 8px;
  font-size: 12px;
  color: var(--accent); 
  opacity: 1;
}


#modalForm button,
#modalForm .btn-primary {
  border-radius: 16px !important;
}


@media (prefers-color-scheme: dark) {
  #modalForm {
    --bg: #1b1d1f; --text: #eaeaea; --input-bg: #2a2d31;
  }
}
@media (prefers-color-scheme: light) {
  #modalForm {
    --bg: #ffffff; --text: #222; --input-bg: #f9f9f9;
  }
}


@keyframes v26_fadeInScale { 0% { opacity: 0; transform: scale(.96); } 100% { opacity: 1; transform: scale(1); } }
#modalForm.show .dlg, #modalForm.show .modal, #modalForm.show .dialog { animation: v26_fadeInScale .25s ease-out; }
</style>



<style>

@media (prefers-color-scheme: light) {
  #modalForm .v26-field > label { color:#444; }
}
@media (prefers-color-scheme: dark) {
  #modalForm .v26-field > label { color:#ccc; }
}
#modalForm .v26-field > label {
  text-transform: uppercase;
  letter-spacing: 0.3px;
  font-weight: 600;
}


#modalForm button,
#modalForm .btn-primary {
  font-weight: 600;
  padding: 12px 18px; 
}
#modalForm button:hover,
#modalForm .btn-primary:hover {
  box-shadow: 0 2px 6px color-mix(in srgb, var(--accent) 25%, transparent);
}


#modalForm .v26-field input:focus,
#modalForm .v26-field select:focus,
#modalForm .v26-field textarea:focus {
  border-bottom-width: 4px;
  transition: none; 
}


.sidebar-menu i, .nav-item i { margin-right:6px; vertical-align:middle; }
#modalForm button i { margin-right:6px; vertical-align:middle; }


#modalForm .dlg, #modalForm .modal, #modalForm .dialog {
  max-width: 704px; 
  box-shadow: 0 6px 18px rgba(0,0,0,0.25);
  position: relative;
  z-index: 9999;
}


#modalForm.show::before {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  z-index: 9998;
  animation: v27_overlayFade .25s ease-out;
}
@keyframes v27_overlayFade {
  from { opacity: 0; } to { opacity: 1; }
}


</style>



<style>

#modalForm .v26-field {
  margin-top: 8px !important;
  margin-bottom: 6px !important;
}
#modalForm .form-group {
  margin-bottom: 10px !important;
}
#modalForm input,
#modalForm select,
#modalForm textarea {
  padding: 10px 8px 4px 8px !important;
}


#modalForm .dlg, #modalForm .modal, #modalForm .dialog {
  max-width: 704px;       
  max-height: 95%;        
  border-radius: 12px;    
  box-shadow: 0 6px 18px rgba(0,0,0,0.25);
  position: relative;
  z-index: 9999;
}


#modalForm.show::before {
  content: "";
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.6);
  z-index: 9998;
  animation: v28_overlayFade .25s ease-out;
}
@keyframes v28_overlayFade {
  from { opacity: 0; }
  to { opacity: 1; }
}


</style>



<style>

@media (max-width: 600px) {
  #modalForm .dlg, #modalForm .modal, #modalForm .dialog {
    width: 94% !important;
    max-width: 600px !important;
    max-height: 92vh !important;
    border-radius: 14px !important;
  }
  #modalForm .v26-field {
    margin-top: 6px !important;
    margin-bottom: 5px !important;
  }
  #modalForm input,
  #modalForm select,
  #modalForm textarea {
    padding: 8px 6px 3px 6px !important;
    font-size: 14px !important;
  }
  #modalForm .v26-field > label {
    font-size: 14px !important;
  }
  #modalForm button,
  #modalForm .btn-primary {
    font-size: 14px !important;
    padding: 10px 14px !important;
    border-radius: 14px !important;
  }
  #modalForm textarea {
    min-height: 70px !important;
  }
  #modalForm {
    font-size: 14px !important;
  }
}
</style>



<style>

#modalForm .v26-field label i {
  margin-right: 6px;           
  vertical-align: middle;      
  position: relative;
  top: -1px;                   
  font-size: 15px;             
  opacity: 0.9;                
}


#modalForm .v26-field > label {
  display: flex;
  align-items: center;
  gap: 6px;                    
  line-height: 1.2;
  white-space: nowrap;
}
</style>



<style>

@media (min-width: 768px) {
  #modalForm[data-jenis="tarik"] .v26-field label i:hover { color:#4CAF50; filter:brightness(1.2) saturate(1.3); transition:color .2s ease,filter .2s ease; }
  #modalForm[data-jenis="transfer"] .v26-field label i:hover { color:#2196F3; filter:brightness(1.2) saturate(1.3); transition:color .2s ease,filter .2s ease; }
  #modalForm[data-jenis="pulsa"] .v26-field label i:hover { color:#9C27B0; filter:brightness(1.2) saturate(1.3); transition:color .2s ease,filter .2s ease; }
  #modalForm[data-jenis="fee brilink"] .v26-field label i:hover { color:#FFC107; filter:brightness(1.2) saturate(1.3); transition:color .2s ease,filter .2s ease; }
  #modalForm[data-jenis="jasa"] .v26-field label i:hover { color:#607D8B; filter:brightness(1.2) saturate(1.3); transition:color .2s ease,filter .2s ease; }
}


#modalForm[data-jenis="tarik"] .v26-field input:focus,
#modalForm[data-jenis="tarik"] .v26-field select:focus,
#modalForm[data-jenis="tarik"] .v26-field textarea:focus { box-shadow:0 0 0 3px color-mix(in srgb, #4CAF50 25%, transparent); transition:box-shadow .15s ease-in-out; }
#modalForm[data-jenis="transfer"] .v26-field input:focus,
#modalForm[data-jenis="transfer"] .v26-field select:focus,
#modalForm[data-jenis="transfer"] .v26-field textarea:focus { box-shadow:0 0 0 3px color-mix(in srgb, #2196F3 25%, transparent); transition:box-shadow .15s ease-in-out; }
#modalForm[data-jenis="pulsa"] .v26-field input:focus,
#modalForm[data-jenis="pulsa"] .v26-field select:focus,
#modalForm[data-jenis="pulsa"] .v26-field textarea:focus { box-shadow:0 0 0 3px color-mix(in srgb, #9C27B0 25%, transparent); transition:box-shadow .15s ease-in-out; }
#modalForm[data-jenis="fee brilink"] .v26-field input:focus,
#modalForm[data-jenis="fee brilink"] .v26-field select:focus,
#modalForm[data-jenis="fee brilink"] .v26-field textarea:focus { box-shadow:0 0 0 3px color-mix(in srgb, #FFC107 25%, transparent); transition:box-shadow .15s ease-in-out; }
#modalForm[data-jenis="jasa"] .v26-field input:focus,
#modalForm[data-jenis="jasa"] .v26-field select:focus,
#modalForm[data-jenis="jasa"] .v26-field textarea:focus { box-shadow:0 0 0 3px color-mix(in srgb, #607D8B 25%, transparent); transition:box-shadow .15s ease-in-out; }


#modalForm button,
#modalForm .btn-primary {
  background: var(--accent) !important;
  color: #fff !important;
  border: none !important;
}
#modalForm button:hover, #modalForm button:focus,
#modalForm .btn-primary:hover, #modalForm .btn-primary:focus {
  box-shadow: 0 0 12px color-mix(in srgb, var(--accent) 25%, transparent);
  filter: brightness(1.02);
}
#modalForm .btn-secondary, #modalForm .btn-close {
  background: transparent !important;
  color: var(--accent) !important;
  border: 1.5px solid var(--accent) !important;
}
#modalForm .btn-secondary:hover, #modalForm .btn-close:hover {
  box-shadow: 0 0 10px color-mix(in srgb, var(--accent) 22%, transparent);
}


</style>

<style>

:root {
  --v34-danger: #ef4444;
  --v34-danger-ring: rgba(239, 68, 68, 0.25);
}
.v34-invalid {
  border-color: var(--v34-danger) !important;
  box-shadow: 0 0 0 3px var(--v34-danger-ring) !important;
  transition: box-shadow 0.15s ease, border-color 0.15s ease, transform 0.12s ease;
}
.v34-shake {
  animation: v34-shake 0.25s ease;
}
@keyframes v34-shake {
  0%, 100% { transform: translateX(0); }
  20% { transform: translateX(-2px); }
  40% { transform: translateX(2px); }
  60% { transform: translateX(-1.5px); }
  80% { transform: translateX(1.5px); }
}
.v34-label-invalid {
  color: var(--v34-danger) !important;
}
.v34-error {
  font-size: 12px;
  color: var(--v34-danger);
  margin-top: 4px;
  display: none;
}
.v34-error.show {
  display: block;
}
</style>
<style>

@keyframes successPulse {
  0% { box-shadow: 0 0 0 0 rgba(34,197,94,0.5); }
  70% { box-shadow: 0 0 0 8px rgba(34,197,94,0); }
  100% { box-shadow: 0 0 0 0 rgba(34,197,94,0); }
}
.success-pulse {
  animation: successPulse 0.8s ease-out;
  border-color: #22c55e !important;
}
.success-icon {
  position: absolute;
  right: 12px;
  top: 12px;
  color: #22c55e;
  font-size: 22px;
  opacity: 0;
  transform: scale(0.5);
  transition: all 0.3s ease;
}
.success-icon.show {
  opacity: 1;
  transform: scale(1);
}
</style>

<style>
body {
  background: #f2f6fb !important;
}

.main-container {
  width: clamp(92%, 94%, 96%);
  max-width: 1220px;
  margin: 0 auto;
  padding: clamp(14px, 1.8vw, 24px);
}
@media (max-width: 1024px) {
  .main-container {
    width: 96%;
    padding: 12px;
  }
}
@media (max-width: 768px) {
  .main-container {
    width: 98%;
    padding: 8px;
  }
}

.card {
  border-radius: 12px !important;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05) !important;
}
</style>


<style>

.main-container {
  width: 90% !important;
  max-width: 1280px !important;
  margin-left: 40px !important;
  margin-right: auto !important;
  padding: 20px !important;
}


@media (max-width: 1280px) {
  .main-container {
    width: 94% !important;
    margin-left: auto !important;
    margin-right: auto !important;
    padding: 16px !important;
  }
}
@media (max-width: 768px) {
  .main-container {
    width: 98% !important;
    margin: 0 auto !important;
    padding: 10px !important;
  }
}
</style>


<style>


.kpi-saldo-akun {
  display: flex;
  gap: 8px;
  overflow-x: auto;
  max-width: 1200px;
  margin: 0 auto;
  padding-bottom: 6px;
  scroll-behavior: smooth;
  -ms-overflow-style: none;  
  scrollbar-width: none;     
}
.kpi-saldo-akun::-webkit-scrollbar {
  display: none; 
}


section {
  margin-bottom: 12px;
}


.kpi-saldo-title {
  background: #f7f9fb;
  border-radius: 8px;
  padding: 6px 12px;
  font-weight: 600;
  margin-bottom: 6px;
}

.kpi-saldo-akun {
  display: flex;
  gap: 8px;
  overflow-x: auto;
  max-width: 1200px;
  margin: 20 auto;
  padding-bottom: 6px;
  scroll-behavior: smooth;
  -ms-overflow-style: none;  
  scrollbar-width: none;     
}
.kpi-saldo-akun::-webkit-scrollbar {
  display: none; 
}


section {
  margin-bottom: 12px;
}


.kpi-saldo-title {
  background: #f7f9fb;
  border-radius: 8px;
  padding: 6px 12px;
  font-weight: 600;
  margin-bottom: 6px;
}
</style>


<style>



.kpi-saldo-akun {
  display: flex;
  gap: 8px;
  overflow-x: auto;
  max-width: 1200px;
  margin: 0 auto;
  padding-bottom: 6px;
  scroll-behavior: smooth;
  -ms-overflow-style: none;
  scrollbar-width: none;
}
.kpi-saldo-akun::-webkit-scrollbar {
  display: none;
}


section {
  margin-bottom: 12px;
}


.kpi-saldo-title {
  background: #f7f9fb;
  border-radius: 8px;
  padding: 6px 12px;
  font-weight: 600;
  margin-bottom: 6px;
}
</style>


<style>

.branchbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  flex-wrap: wrap;
  gap: 10px;
  padding: 6px 20px;
  max-width: 1200px;
  margin: 0 auto;
  transition: all 0.3s ease;
}

.bb-select, .bb-now {
  flex-shrink: 0;
}

.user-role {
  flex: 1 1 auto;
  text-align: right;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: clamp(120px, 30%, 220px);
}


@media (max-width: 1024px) {
  .branchbar {
    padding: 6px 14px;
    gap: 8px;
  }
  .bb-select, .bb-now {
    font-size: 14px;
  }
  .user-role {
    font-size: 13px;
    max-width: 160px;
  }
}


@media (max-width: 768px) {
  .branchbar {
    flex-direction: column;
    align-items: flex-start;
    gap: 6px;
    padding: 8px 10px;
    border-radius: 10px;
  }
  .bb-select, .bb-now {
    font-size: 13px;
  }
  .user-role {
    text-align: left;
    font-size: 12px;
    max-width: 140px;
  }
}
</style>


<style>



.main-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 16px;
  transition: all 0.3s ease;
}
@media (max-width: 768px) {
  .main-container { padding: 0 8px; }
}


.kpi-transaksi, .kpi-grid {
  display: grid !important;
  grid-template-columns: repeat(auto-fit, minmax(25px, 1fr)) !important;
  gap: 12px !important;
  max-width: 1170px !important;
  margin: 0 auto !important;
  transition: all 0.3s ease;
}
@media (max-width: 1024px) {
  .kpi-transaksi, .kpi-grid {
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)) !important;
  }
}
@media (max-width: 768px) {
  .kpi-transaksi, .kpi-grid {
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)) !important;
  }
}


.total-aset, .total-asset, .totalAset {
  max-width: 1200px;
  margin: 0 auto;
  padding: 8px 16px;
  transition: all 0.3s ease;
}
@media (max-width: 768px) {
  .total-aset, .total-asset, .totalAset {
    padding: 6px 10px;
    font-size: 14px;
  }
}


.kpi-saldo-akun, .kpiSaldoAkun, .saldo-akun-strip {
  display: flex;
  gap: 8px;
  overflow-x: auto;
  max-width: 1200px;
  margin: 0 auto;
  padding-bottom: 6px;
  scroll-behavior: smooth;
  -ms-overflow-style: none;  
  scrollbar-width: none;     
}
.kpi-saldo-akun::-webkit-scrollbar,
.kpiSaldoAkun::-webkit-scrollbar,
.saldo-akun-strip::-webkit-scrollbar { display: none; }


.kpi-saldo-akun > *, .kpiSaldoAkun > *, .saldo-akun-strip > * {
  flex: 0 0 auto;
  padding: 6px 12px;
  border-radius: 8px;
  transition: all 0.3s ease;
}
@media (max-width: 768px) {
  .kpi-saldo-akun > *, .kpiSaldoAkun > *, .saldo-akun-strip > * {
    padding: 4px 10px;
    font-size: 13px;
  }
}


.table-riwayat, .tx-table-wrap, .history-table-wrap {
  overflow-x: auto;
  max-width: 1200px;
  margin: 0 auto;
}
.table-riwayat table, .tx-table-wrap table, .history-table-wrap table, .main-container table {
  width: 100%;
  border-collapse: collapse;
  font-size: 15px;
}
@media (max-width: 768px) {
  .table-riwayat table, .tx-table-wrap table, .history-table-wrap table, .main-container table {
    font-size: 13px;
  }
  .table-riwayat th, .table-riwayat td,
  .tx-table-wrap th, .tx-table-wrap td,
  .history-table-wrap th, .history-table-wrap td {
    padding: 6px;
  }
}


.branchbar {
  max-width: 1200px;
  margin: 0 auto;
}
</style>


<style>

table, th, td { border: 1.0px solid #1d4ed8 !important; border-collapse: collapse !important; }
.card + .ticker { margin-top: 12px !important; }
</style>


<style>

thead th { color: #b91c1c !important; font-weight: 700 !important; }
tbody td { color: #111827 !important; font-weight: 600 !important; }
tbody tr:hover { background: #f1f5ff !important; transition: background 0.2s ease; }
</style>



<style>

.ticker {
  background: #fff;
  color: #222222 !important; 
  font-weight: 800 !important;
  font-size: 16px !important;
  border-bottom: 2px solid #60a5fa !important;
  padding: 10px 0 !important;
  margin-bottom: 16px !important;
}
.ticker-rail {
  gap: 40px !important;
}
.asset-main {
  margin-top: 10px !important;
  margin-bottom: 18px !important;
}
#kpiSaldoWrap {
  margin-top: 14px !important;
}
</style>



<style>

.kpi-grid {
  display: grid !important;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)) !important;
  gap: 12px !important;
  width: 100% !important;
  margin: 0 !important;
  padding: 0 !important;
}
.card h3 + .kpi-grid {
  margin-top: 10px !important;
  margin-left: 0 !important;
  margin-right: 0 !important;
  width: 100% !important;
}
@media (max-width: 768px) {
  .kpi-grid {
    grid-template-columns: repeat(2, 1fr) !important;
    gap: 10px !important;
  }
}
@media (max-width: 480px) {
  .kpi-grid {
    grid-template-columns: 1fr !important;
  }
}

.card {
  padding-left: 12px !important;
  padding-right: 12px !important;
}

.kpi .ic {
  width: 36px !important;
  height: 36px !important;
}
.kpi .meta h4 { font-size: 16px !important; }
.kpi .meta .val { font-size: 15px !important; }
</style>




<style>

.main-container,
.kpi-grid,
.kpi-transaksi,
.card {
  max-width: 100% !important;
  width: 100% !important;
  margin-left: 0 !important;
  margin-right: 0 !important;
  padding-left: 0 !important;
  padding-right: 0 !important;
}


.branchbar {
  width: 100% !important;
  max-width: 100% !important;
  margin: 0 !important;
  padding-left: 10px !important;
  padding-right: 10px !important;
}


@media (max-width: 768px) {
  .main-container, .branchbar {
    padding-left: 6px !important;
    padding-right: 6px !important;
  }
}
</style>



<style>



.card:has(.kpi-grid) {
  padding-left: 0 !important;
  padding-right: 0 !important;
  border-radius: 0 !important;
  box-shadow: none !important;
  margin-left: 0 !important;
  margin-right: 0 !important;
  width: 100% !important;
}


.kpi-grid {
  width: 100% !important;
  margin: 0 !important;
  padding: 0 !important;
  gap: 10px !important;
}


@media (max-width: 768px) {
  .card:has(.kpi-grid) {
    border-radius: 0 !important;
    padding: 0 !important;
  }
  .kpi-grid {
    grid-template-columns: repeat(2, 1fr) !important;
  }
}
</style>


<style>
:root{--accent:#2196f3}
body{background:#f2f6fb !important}
.card h3{font-size:18px;font-weight:700;margin:0 0 10px 0}
.kpi .meta h4{font-size:22px!important}
.kpi .meta .val{font-size:16px!important}
.ticker{background:#60a5fa !important;color:#ffffff !important;border-bottom:2px solid #1e40af !important;padding:12px 0 !important}
.main-container{max-width:1200px;margin:0 auto;padding:0 16px;transition:all .3s ease}
@media(max-width:768px){.main-container{padding:0 8px}}
.kpi-grid{display:grid !important;grid-template-columns:repeat(auto-fit,minmax(160px,1fr))!important;gap:12px!important;width:100%!important;margin:0!important;padding:0!important}
.card:has(.kpi-grid){padding-left:0!important;padding-right:0!important;border-radius:0!important;box-shadow:none!important;margin-left:0!important;margin-right:0!important;width:100%!important}
.table-wrapper,.table-riwayat,.tx-table-wrap,.history-table-wrap{overflow-x:auto;max-width:1200px;margin:0 auto}
</style>


<style>
/* === Fix: Table size restored to full width === */
.table-wrapper, .table-riwayat, .tx-table-wrap, .history-table-wrap {
  overflow-x: auto;
  width: 100% !important;
  margin: 0 !important;
  max-width: none !important;
}
.table-riwayat table {
  width: 100%;
  font-size: 14px;
}

/* === Fix: KPI font resized to more proportional scale === */
.kpi .meta h4 {
  font-size: 18px !important;
}
.kpi .meta .val {
  font-size: 14.5px !important;
}
</style>


<style>
/* === Fix: Smaller font for KPI titles === */
.kpi .meta h4 {
  font-size: 15px !important;
  font-weight: 700 !important;
  line-height: 1.2;
}
.kpi .meta .val {
  font-size: 13.5px !important;
  font-weight: 500;
}
</style>


<style>
/* === Fix: KPI cards fill full width on large screens === */
.kpi-grid {
  display: grid !important;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)) !important;
  gap: 12px !important;
  width: 100% !important;
  margin: 0 auto !important;
  padding: 0 !important;
  max-width: none !important;
}
.kpi-grid .kpi {
  flex: 1 1 auto;
  width: 100%;
}
</style>


<style>
/* === Responsive Fix: Font KPI lebih kecil di layar HP === */
@media (max-width: 600px) {
  .kpi .meta h4 {
    font-size: 13px !important;
  }
  .kpi .meta .val {
    font-size: 12px !important;
  }
  .kpi {
    padding: 8px 6px !important;
  }
  .kpi-grid {
    gap: 8px !important;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)) !important;
  }
}
</style>


<style>
/* === Visual Fix: Separate ticker blue background from KPI cards === */
.card {
  background: #ffffff !important;
  border-radius: 10px !important;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05) !important;
}
.kpi-grid {
  background: transparent !important;
}
</style>

</head>
<body>
<div class="layout">
  
  <aside class="sidebar" id="sidebar">
    <div class="brand">Amko MiniLink</div>
    <nav class="nav" id="menuList"></nav>
    <div class="footer">
      <a href="#" id="lnk-logout-visual" class="logout">üö™ Logout</a>
    </div>
  </aside>

  
  <div>
    
    <div id="branchTopBar" class="branchbar">
      <button id="toggleSidebar" class="hamburger" aria-label="Toggle Sidebar" aria-controls="sidebar" aria-expanded="false">‚ò∞</button>
      <select id="branchTopSelect" class="bb-select"><option value="">-- Pilih Toko --</option></select>
      <span class="bb-now">TOKO: <strong id="bbNowName">-</strong></span>
      <span id="userRole" class="user-role">-</span>
    </div>

    </div>

    
    <div class="main-container">
  <div class="grid">
      
      <div class="card">
        <h3>KPI Transaksi <span id="kpiTglLabel" class="bb-now" style="margin-left:8px">Hari ini</span></h3>
        <div class="kpi-grid">
          <div class="kpi blue">
            <div class="ic">üîÅ</div>
            <div class="meta"><h4>TRANSFER</h4><div class="val" id="kpi_transfer">Rp 0</div></div>
          </div>
          <div class="kpi green">
            <div class="ic">üíµ</div>
            <div class="meta"><h4>TARIK TUNAI</h4><div class="val" id="kpi_tarik">Rp 0</div></div>
          </div>
          <div class="kpi amber">
            <div class="ic">üìä</div>
            <div class="meta"><h4>OMSET</h4><div class="val" id="kpi_omset">Rp 0</div></div>
          </div>
          <div class="kpi orange">
            <div class="ic">üè¶</div>
            <div class="meta"><h4>ADM BANK</h4><div class="val" id="kpi_fee">Rp 0</div></div>
          </div>
          <div class="kpi brown">
            <div class="ic">‚öôÔ∏è</div>
            <div class="meta"><h4>OPERASIONAL</h4><div class="val" id="kpi_opr">Rp 0</div></div>
          </div>
          <div class="kpi profit" id="kpi_profit_wrap" style="display:none">
            <div class="ic">üíπ</div>
            <div class="meta"><h4>PROFIT</h4><div class="val" id="kpi_profit">Rp 0</div></div>
          </div>
        </div>
      </div>

      
    <div class="ticker" id="tickerBar" aria-live="polite">
      <div class="ticker-rail" id="tickerRail">
        <span class="ticker-chunk" id="tickerA">Memuat motivasi‚Ä¶</span>
        <span class="ticker-chunk" id="tickerB">Memuat motivasi‚Ä¶</span>
      </div>
    

      
      <div class="card">
        <div class="asset-main">
          <div class="asset-label">TOTAL ASET</div>
          <div class="asset-value" id="assetTotalValue">Rp 0</div>
        </div>
      </div>

      
      <div class="card">
        <h3>KPI Master Saldo Akun</h3>
        <div id="kpiSaldoWrap" class="kpi-grid"></div>
      </div>

      
      <div class="card">
        <h3>Riwayat Transaksi</h3>

        <div class="filters">
          <input id="fltDate" type="date" class="date-input" />
          <select id="fltUser" class="sel"><option value="">Semua User</option></select>
          <select id="fltJenis" class="sel">
            <option value="">Semua Jenis</option>
            <option value="tarik">Tarik Tunai</option>
            <option value="transfer">Transfer</option>
            <option value="pulsa">Pulsa / Kuota</option>
            <option value="jasa">Jasa ATM</option>
          </select>
          <select id="fltRek" class="sel"><option value="">Semua Rek/Server</option></select>

          <div style="flex:1"></div>

          <button id="btnTambah" class="btn-sm btn-primary">‚ûï Transaksi</button>
          <button class="btn-sm btn-wa" id="btnWA">üì≤ WhatsApp</button>
          <button class="btn-sm btn-excel" id="btnExport" disabled>üìä Excel</button>
        </div>

        <div id="totalTransaksi" style="margin:6px 0;font-weight:bold;">Jumlah Total Transaksi = 0</div>

        <div class="table-wrapper" style="border:1px solid var(--border);border-radius:12px">
          <table>
            <thead>
              <tr>
                <th>No urut</th>
                <th>User & Tanggal</th>
                <th>ID Trx</th>
                <th>Sumber Dana</th>
                <th>Jenis</th>
                <th>Saldo Awal</th>
                <th>Nominal</th>
                <th>Admin Dalam</th>
                <th>Admin Luar</th>
                <th>Fee Bank</th>
                <th>Saldo Akhir</th>
                <th>Keterangan</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody id="tb"></tbody>
          </table>
        </div>

        <div style="margin-top:10px;display:flex;gap:8px;align-items:center;justify-content:center;">
          <button class="btn-sm btn-ghost" id="btnPrev">‚ü® Prev</button>
          <span class="bb-now" id="pageInfo">Hal 1</span>
          <button class="btn-sm btn-ghost" id="btnNext">Next ‚ü©</button>
        </div>
      </div>
    </div>
  </div>
</div>
</div>


<div class="loading-overlay" id="loadingOverlay" aria-live="polite" aria-busy="true">
  <div class="loading-card">
    <div class="spinner" aria-hidden="true"></div>
    <div>
      <div class="loading-text">Memuat data‚Ä¶</div>
      <div class="loading-sub" id="loadingSub">Mengambil riwayat transaksi</div>
    </div>
  </div>
</div>


<div class="modal" id="modalJenis">
  <div class="dialog">
    <div class="dlg-hd">
      <span>Pilih Jenis Transaksi</span>
      <button class="btn btn-ghost btn-sm" id="xJenis" style="height:40px">‚úñ</button>
    </div>
    <div class="dlg-bd" style="padding:16px">
      <div style="display:grid;gap:10px">
        <button class="btn-sm btn-ghost" style="height:48px;font-size:15px" data-pilih="tarik">Tarik Tunai</button>
        <button class="btn-sm btn-ghost" style="height:48px;font-size:15px" data-pilih="transfer">Transfer</button>
        <button class="btn-sm btn-ghost" style="height:48px;font-size:15px" data-pilih="pulsa">Pulsa / Kuota</button>
        <button class="btn-sm btn-ghost" style="height:48px;font-size:15px" data-pilih="jasa">Jasa ATM</button>
        
      </div>
    </div>
  </div>
</div>

<div class="modal" id="modalForm">
  <div class="dialog">
    <div class="dlg-hd">
      <span id="dlgTitle">Form Transaksi</span>
      <button class="btn btn-ghost btn-sm" id="xForm" style="height:40px">‚úñ</button>
    </div>
    <div class="dlg-bd" data-validate="true">
      <div id="msgErr" style="display:none;background:#fef2f2;border:1px solid #fecaca;color:#991b1b;padding:10px;border-radius:10px"></div>

      <div class="row">
        <div>
          <label>Jenis</label>
          <div class="icon-input"><span>üìÇ</span><input id="f_jenis" readonly /></div>
        </div>
        <div>
          <label>Cabang</label>
          <div class="icon-input"><span>üè¨</span><input id="f_branch" readonly /></div>
        </div>
      </div>

      <div class="row" id="rowSumber">
        <div>
          <label>Sumber Dana</label>
          <div class="icon-input"><span>‚ÜóÔ∏è</span><select id="f_sumber" required></select></div>
        </div>
        <div>
          <label>Terima Dana</label>
          <div class="icon-input"><span>‚ÜòÔ∏è</span><select id="f_terima" required></select></div>
        </div>
      </div>

      <div class="row" id="rowNominal">
        <div>
          <label id="labelNominal">Nominal (Rp)</label>
          <div class="icon-input"><span>Rp</span><input id="f_nom" required inputmode="numeric" placeholder="0" /></div>
        </div>
      </div>

      <div class="row" id="rowAdminDua">
        <div>
          <label>Admin Dalam</label>
          <div class="icon-input"><span>üí∏</span><input id="f_admin_dalam" inputmode="numeric" placeholder="0" /></div>
        </div>
        <div>
          <label>Admin Luar</label>
          <div class="icon-input"><span>üí∏</span><input id="f_admin_luar" inputmode="numeric" placeholder="0" /></div>
        </div>
      </div>

      <div class="row" id="rowAdminLuarOnly" style="display:none">
        <div>
          <label>Admin Luar</label>
          <div class="icon-input"><span>üí∏</span><input id="f_admin_luar_only" inputmode="numeric" placeholder="0" /></div>
        </div>
      </div>

      <div class="row" id="rowFeeBank" style="display:none">
        <div>
          <label>Fee Bank (Transfer)</label>
          <div class="icon-input"><span>üè¶</span><input id="f_fee_bank" inputmode="numeric" placeholder="0" /></div>
        </div>
      </div>

      <div class="row" id="rowPulsa" style="display:none">
        <div>
          <label>Modal (harga modal)</label>
          <div class="icon-input"><span>Rp</span><input id="f_modal" inputmode="numeric" placeholder="0" /></div>
        </div>
        <div>
          <label>Jual (harga jual)</label>
          <div class="icon-input"><span>Rp</span><input id="f_jual" inputmode="numeric" placeholder="0" /></div>
        </div>
      </div>

      <div>
        <label>Keterangan (wajib diisi, mis. No HP / No Ref)</label>
        <div class="icon-input"><input id="f_ket" required type="text" maxlength="50" placeholder="contoh: 081234567890" required /></div>
      </div>
    </div>
    <div class="dlg-ft">
      <button class="btn btn-ghost btn-sm" id="batalForm">Batal</button>
      <button class="btn btn-primary btn-sm" id="simpanForm">Simpan</button>
    </div>
  </div>
</div>

<script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js@2'
  const supabase = createClient(
    "https://kfqcdcvcnyhisbmwftzb.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtmcWNkY3ZjbnloaXNibXdmdHpiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg1MTY0ODIsImV4cCI6MjA3NDA5MjQ4Mn0.EMp1XoHvi7CcN91lQW8mhfLQnaZHpCGkVo93Q3Ty03Y",
    { auth:{ persistSession:true, autoRefreshToken:true } }
  );

  const $ = id=>document.getElementById(id)
  const fmtRp  = n => "Rp " + new Intl.NumberFormat('id-ID').format(Number(n||0))
  const fmtNum = n => new Intl.NumberFormat('id-ID').format(Number(n||0))
  const parseNum = v => Number(String(v||'').replace(/[^0-9]/g,''))||0

  // === Generator ID Trx 9 karakter ===
  function genIdTrx() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let id = '';
    for (let i = 0; i < 9; i++) id += chars.charAt(Math.floor(Math.random() * chars.length));
    return id;
  }

  const getActive = ()=>({ code: localStorage.getItem('current_branch_code')||'', name: localStorage.getItem('current_branch_name')||'' })
  const setActive = (code,name)=>{ localStorage.setItem('current_branch_code',code||''); localStorage.setItem('current_branch_name',name||'') }

  let gRole=null, gBranch=null, viewBranch=null
  let cacheAcc={ cash:[], rekening:[], server_pulsa:[] }
  let lastRiwayatRows=[]
  let editMode=false, editId=null

  let page=0, pageSize=25, totalRows=0

  // Range tanggal
  let range={from:null,to:null}
  const toISODate = d => new Date(d).toISOString().slice(0,10)
  const startOfDayISO = d=>{const x=new Date(d);x.setHours(0,0,0,0);return x.toISOString()}
  const endOfDayISO   = d=>{const x=new Date(d);x.setHours(23,59,59,999);return x.toISOString()}
  const fmtHuman = d=> new Date(d).toLocaleString('id-ID',{day:'2-digit',month:'short',year:'numeric',hour:'2-digit',minute:'2-digit'})
  const fmtHumanDateOnly = d => new Date(d).toLocaleDateString('id-ID',{day:'2-digit',month:'short',year:'numeric'})

  const flt = { user:'', jenis:'', acc:'' }

  // WA summary
  const saldoSum = { cash:0, rek:0, asset:0, server:0 }
  let waRekeningList = [], waServerList = [], waCashList = []

  
  function showLoading(on=true, sub='Memuat data‚Ä¶'){
    const ol = $('loadingOverlay'); if(!ol) return
    $('loadingSub').textContent = sub || 'Memuat data‚Ä¶'
    ol.classList.toggle('show', !!on)
    document.body.style.overflow = on ? 'hidden' : 'auto'
  }

  


function showToast(msg, isError=false) {
  const t = document.getElementById('toast');
  if (!t) return;
  t.textContent = msg;
  t.className = 'toast' + (isError ? ' error' : '');
  setTimeout(() => t.classList.add('show'), 10);
  setTimeout(() => t.classList.remove('show'), 3000);
}


  const TICKER_QUOTES = [
    "Fokus pada proses, hasil akan menyusul",
    "Disiplin kecil hari ini jadi lompatan besar esok",
    "Bekerja jujur, rezeki bertemu jalan",
    "Konsisten lebih kuat dari motivasi sesaat",
    "Belajar dari data, bergerak dengan hati",
    "Progress lebih penting daripada perfect",
    "Kerja tuntas, tidur nyenyak",
    "Kepercayaan dibangun dari akurasi",
    "Setiap angka bercerita‚Äîbaca, pahami, bertindak",
    "Tidak ada alasan, yang ada solusi"
  ]
  const TICKER_DURATION_S = 6
  const TICKER_GAP_PX = 10
  let _tickerIndex = 0

  function buildQuoteLine(){
    const MAX_PER_LOOP = 2;
    const ordered=[]
    for(let i=0;i<MAX_PER_LOOP;i++){
      ordered.push(TICKER_QUOTES[(_tickerIndex+i)%TICKER_QUOTES.length])
    }
    return ordered.join('   ‚Ä¢   ')
  }
  function adjustTickerLayout(){
    const rail = document.getElementById('tickerRail')
    const a = document.getElementById('tickerA')
    if(!rail || !a) return
    const shift = a.offsetWidth + TICKER_GAP_PX
    rail.style.setProperty('--ticker-shift', shift + 'px')
    rail.style.setProperty('--ticker-speed', TICKER_DURATION_S + 's')
  }
  function updateTicker(){
    const a = document.getElementById('tickerA')
    a.textContent = buildQuoteLine()
    const b = document.getElementById('tickerB')
    b.textContent = a.textContent
    const rail = document.getElementById('tickerRail')
    rail.style.animation = 'none'; void rail.offsetWidth
    adjustTickerLayout()
    rail.style.animation = `ticker-marquee var(--ticker-speed) linear infinite`
    _tickerIndex = (_tickerIndex + 1) % TICKER_QUOTES.length
  }
  function startTickerRotation(){
    updateTicker()
    window.addEventListener('resize', adjustTickerLayout)
    setInterval(updateTicker, TICKER_DURATION_S * 500)
  }

  // Mask angka
  ;(()=>{['f_nom','f_admin_dalam','f_admin_luar','f_admin_luar_only','f_fee_bank','f_modal','f_jual'].forEach(id=>{
    const el=$(id); if(!el) return; el.addEventListener('input',e=>{const raw=e.target.value.replace(/\D/g,''); e.target.value = raw? new Intl.NumberFormat('id-ID').format(Number(raw)) : ''})
  })})()

  function setPresetToday(){
    const today = new Date()
    const iso = toISODate(today)
    range.from = iso; range.to = iso
    $('fltDate').value = iso
    $('kpiTglLabel').textContent = fmtHumanDateOnly(today)
  }
  function setDateRange(dateISO){
    range.from = dateISO; range.to = dateISO
    $('kpiTglLabel').textContent = fmtHumanDateOnly(dateISO)
  }
  function getRangeISO(){
    const pick = range.from || toISODate(new Date())
    const tmin = startOfDayISO(new Date(pick))
    const tmax = endOfDayISO(new Date(pick))
    return { tmin, tmax }
  }

  // ===== BOOT =====
  async function boot(){
    setPresetToday()

    const { data:{ session } } = await supabase.auth.getSession()
    if(!session){ location.href='login.html'; return }

    const { data: prof } = await supabase.from('profiles').select('role,branch_code,full_name,email').eq('id', session.user.id).single()
    gRole = (prof?.role||'').toLowerCase() || (localStorage.getItem('user_role')||'kasir')
    gBranch = (prof?.branch_code||'').trim()

    if ((gRole||'') !== 'owner') {
      setActive(gBranch, gBranch)
      viewBranch = gBranch
    } else {
      const saved = getActive()
      viewBranch = saved.code || gBranch || ''
    }

    const nm = (prof?.full_name || prof?.email || '-').split(' ')[0].toUpperCase()
    $('userRole').textContent = `${nm}‚Äì${(gRole||'').toUpperCase()}`
    $('kpi_profit_wrap').style.display = (gRole==='owner') ? 'flex' : 'none'

    await initSidebar()
    await initBranchBar()
    await loadAccounts()
    await populateFilterOptions()
    $('fltDate').addEventListener('change', async ()=>{
      const val = $('fltDate').value || toISODate(new Date())
      setDateRange(val); $('btnExport').disabled = true; await refreshByRange()
    })
    $('btnWA').addEventListener('click', sendWhatsAppSummary)

    await refreshByRange()
    startTickerRotation()
  }

  async function refreshByRange(){
    page=0
    showLoading(true, 'Menghitung KPI & memuat saldo akun')
    await loadKPITransaksi()
    await refreshSaldoAkun()
    showLoading(true, 'Mengambil riwayat transaksi')
    await loadRiwayat()
    showLoading(false)
  }

  async function loadAccounts(){
    if(!viewBranch) return
    const { data } = await supabase.from('accounts').select('id,name,account_type,branch_code,saldo').eq('branch_code', viewBranch).order('name')
    cacheAcc={ cash:[], rekening:[], server_pulsa:[] }
    ;(data||[]).forEach(a=>{ if(cacheAcc[a.account_type]) cacheAcc[a.account_type].push(a) })
  }

  async function populateFilterOptions(){
    const uSel = $('fltUser')
    if(viewBranch){
      const { data: users } = await supabase.from('profiles').select('full_name,branch_code').eq('branch_code', viewBranch).order('full_name')
      uSel.innerHTML = '<option value="">Semua User</option>' + (users||[])
        .filter(u=>u.full_name && u.full_name.trim().length>0)
        .map(u=>`<option value="${u.full_name}">${u.full_name}</option>`).join('')
    } else { uSel.innerHTML = '<option value="">Semua User</option>' }

    const list=[...(cacheAcc.rekening||[]), ...(cacheAcc.server_pulsa||[])]
    const rSel = $('fltRek')
    rSel.innerHTML = '<option value="">Semua Rek/Server</option>' + list.map(a=>`<option value="${a.id}">${a.name}</option>`).join('')

    uSel.onchange = ()=>{ flt.user = uSel.value||''; $('btnExport').disabled=true; refreshByRange() }
    $('fltJenis').onchange = ()=>{ flt.jenis = $('fltJenis').value||''; $('btnExport').disabled=true; refreshByRange() }
    rSel.onchange = ()=>{ flt.acc = rSel.value||''; $('btnExport').disabled=true; refreshByRange() }
  }

  // KPI transaksi
  async function loadKPITransaksi(){
    const { tmin, tmax } = getRangeISO()
    const { data } = await supabase.from('transactions')
      .select('jenis, nominal, admin_dalam, admin_luar, fee_bank, branch_code, created_at')
      .eq('branch_code', viewBranch).gte('created_at', tmin).lte('created_at', tmax)

    let omset=0, tarik=0, transfer=0, fee=0, profit=0, opr=0
    for(const r of (data||[])){
      const n=+r.nominal||0, ad=+r.admin_dalam||0, al=+r.admin_luar||0, fb=+r.fee_bank||0
      if(r.jenis==='tarik')     tarik+=n
      else if(r.jenis==='transfer') transfer+=n
      else if(r.jenis==='jasa') opr += al
      
      if(r.jenis==='fee_brilink'){  }
      omset+=n; fee+=fb; profit += (ad+al-fb)
    }
    $('kpi_omset').textContent=fmtRp(omset)
    $('kpi_tarik').textContent=fmtRp(tarik)
    $('kpi_transfer').textContent=fmtRp(transfer)
    $('kpi_fee').textContent=fmtRp(fee)
    $('kpi_opr').textContent=fmtRp(opr)
    if(gRole==='owner') $('kpi_profit').textContent=fmtRp(profit)
  }

  // Asset & saldo
  function updateAssetBar(list){
    const totalAsset = (list||[]).reduce((s,a)=> s + Number(a.saldo||0), 0)
    saldoSum.asset = totalAsset
    $('assetTotalValue').textContent = fmtRp(totalAsset)
  }
  async function refreshSaldoAkun(){
    const { data } = await supabase.from('accounts').select('id,name,account_type,branch_code,saldo').eq('branch_code', viewBranch).order('name')

    const cashArr = (data||[]).filter(a=>a.account_type==='cash')
    const rekArr  = (data||[]).filter(a=>a.account_type==='rekening')
    const srvArr  = (data||[]).filter(a=>a.account_type==='server_pulsa')

    saldoSum.cash = cashArr.reduce((s,a)=>s + Number(a.saldo||0), 0)
    saldoSum.rek  = rekArr.reduce((s,a)=>s + Number(a.saldo||0), 0)
    saldoSum.server = srvArr.reduce((s,a)=>s + Number(a.saldo||0), 0)
    saldoSum.asset = saldoSum.cash + saldoSum.rek + saldoSum.server

    waCashList     = cashArr.map(a=>({ name: a.name||'Cash', saldo: Number(a.saldo||0) }))
    waRekeningList = rekArr.map(a=>({ name: a.name||'Rekening', saldo: Number(a.saldo||0) }))
    waServerList   = srvArr.map(a=>({ name: a.name||'Server', saldo: Number(a.saldo||0) }))

    updateAssetBar(data||[])
    renderKPISaldoCards(data||[])
  }
  function renderKPISaldoCards(list){
    const wrap=$('kpiSaldoWrap')
    const laci=(list||[]).filter(a=> a.account_type==='cash' && /laci/i.test(a.name||''))
    const rek=(list||[]).filter(a=> a.account_type==='rekening').sort((a,b)=>(a.name||'').localeCompare(b.name||''))
    const srv=(list||[]).filter(a=> a.account_type==='server_pulsa').sort((a,b)=>(a.name||'').localeCompare(b.name||''))

    const card = a => `
      <div class="kpi-card" title="ID: ${a.id}">
        <div class="kpi-title">${a.name|| (a.account_type||'').toUpperCase()}</div>
        <div class="kpi-value">${fmtRp(a.saldo||0)}</div>
      </div>
    `
    let html=''
    laci.forEach(a=> html+=card(a))
    rek.forEach(a=> html+=card(a))
    srv.forEach(a=> html+=card(a))
    if(!html) html = `<div class="kpi-card"><div class="kpi-title">Tidak ada akun</div><div class="kpi-value">Rp 0</div></div>`
    wrap.innerHTML=html
  }

  // CSV export
  function csvEscape(v){ if(v==null) return ''; const s=String(v).replace(/\r?\n/g,' ').replace(/\s+/g,' ').trim(); return /[",;]/.test(s)?`"${s.replace(/"/g,'""')}"`:s }
  function updateExportState(){ const hasData = (lastRiwayatRows||[]).length > 0; $('btnExport').disabled = !hasData }
  function exportCSV(){
    const rows=lastRiwayatRows||[]; if(rows.length===0) return
    const header=['No urut','User','Tanggal','ID Trx','Sumber Dana','Jenis','SRC Saldo Awal','DST Saldo Awal','Nominal','Admin Dalam','Admin Luar','Fee Bank','SRC Saldo Akhir','DST Saldo Akhir','Keterangan']
    const lines=[header.join(',')]
    let i=1 + page*pageSize
    for(const r of rows){
      const rec=[i++,r.created_by_name||'',fmtHuman(r.created_at),(r.id_trx||r.id),
        `${r.src_account_name||''}${r.dst_account_name?` ‚Üí ${r.dst_account_name}`:''}`, r.jenis||'',
        (r.src_saldo_awal??''),(r.dst_saldo_awal??''),(r.nominal??0),(r.admin_dalam??0),(r.admin_luar??0),(r.fee_bank??0),(r.src_saldo_akhir??''),(r.dst_saldo_akhir??''), r.note||''].map(csvEscape)
      lines.push(rec.join(','))
    }
    const f=range.from||toISODate(new Date())
    const fname = `riwayat_${f}_p${page+1}.csv`
    const blob=new Blob([lines.join('\n')],{type:'text/csv;charset=utf-8;'}); const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=fname; a.click(); setTimeout(()=>URL.revokeObjectURL(a.href),500)
  }
  $('btnExport').onclick=exportCSV

  // WA summary
  function fmtMakassar(dt=new Date()){
    const tz='Asia/Makassar', pad=n=>String(n).padStart(2,'0')
    const z=new Date(dt.toLocaleString('en-US',{timeZone:tz}))
    return `${pad(z.getDate())}-${pad(z.getMonth()+1)}-${z.getFullYear()} ${pad(z.getHours())}:${pad(z.getMinutes())}:${pad(z.getSeconds())}`
  }
  function buildWhatsAppText(){
    const cab = localStorage.getItem('current_branch_name') || viewBranch || '-'
    const header = [
      `*LAPORAN SUMBER DANA,*`,``,`*CABANG : ${cab}*`,``,`*Report By:* ${$('userRole').textContent || '-'}`,`*Generated at:* ${fmtMakassar()}`
    ].join('\n')
    const section = (title, list) => {
      if(!list || !list.length) return ''
      let lines = list.map((a,i)=>`${i+1}. ${a.name}: ${fmtRp(a.saldo||0)}`).join('\n')
      let subtotal = list.reduce((s,a)=> s + Number(a.saldo||0), 0)
      return [``, `*> ${title}*`, lines, ``, `*Subtotal ${title}:* ${fmtRp(subtotal)}`, ``].join('\n')
    }
    const bankTxt   = section('BANK', waRekeningList)
    const serverTxt = section('SERVER PULSA', waServerList)
    const cashTxt   = section('LACI / CASH', waCashList)
    const totalTxt  = `*TOTAL ASSET:* ${fmtRp(saldoSum.asset)}`
    return [header, bankTxt, serverTxt, cashTxt, totalTxt].filter(Boolean).join('\n')
  }
  function sendWhatsAppSummary(){
    const txt = buildWhatsAppText()
    const url = `https://wa.me/?text=${encodeURIComponent(txt)}`
    window.open(url, '_blank')
  }

  // Riwayat
  const saldoBlock = (srcName, srcVal, dstName, dstVal) => {
    const fmt = v => (v ?? null) !== null ? fmtNum(v) : '-'
    let html = ''
    if (srcName || srcVal !== undefined) html += `<div>${(srcName || 'SRC')}: <b>${fmt(srcVal)}</b></div>`
    if (dstName || dstVal !== undefined) html += `<div>${(dstName || 'DST')}: <b>${fmt(dstVal)}</b></div>`
    return html || '-'
  }

  async function loadRiwayat(){
    const { tmin, tmax } = getRangeISO()
    if(!viewBranch){
      $('tb').innerHTML=`<tr><td colspan="13">Pilih cabang terlebih dahulu.</td></tr>`
      lastRiwayatRows=[]; updateExportState(); return
    }

    let qCount = supabase.from('v_tx_summary').select('*',{ count:'exact', head:true })
      .eq('branch_code', viewBranch).gte('created_at', tmin).lte('created_at', tmax)
    if(flt.jenis) qCount = qCount.eq('jenis', flt.jenis)
    if(flt.user)  qCount = qCount.eq('created_by_name', flt.user)
    if(flt.acc)   qCount = qCount.or(`src_account_id.eq.${flt.acc},dst_account_id.eq.${flt.acc}`)
    const { count:cnt } = await qCount
    totalRows = cnt || 0
    $('totalTransaksi').textContent = 'Jumlah Total Transaksi = ' + totalRows

    let dataQuery = supabase.from('v_tx_summary').select(`
      id, id_trx, jenis, src_account_id, src_account_name, dst_account_id, dst_account_name,
      nominal, admin_dalam, admin_luar, fee_bank,
      src_saldo_awal, src_saldo_akhir, dst_saldo_awal, dst_saldo_akhir,
      note, created_by_name, created_at, branch_code
    `).eq('branch_code', viewBranch).gte('created_at', tmin).lte('created_at', tmax)
    if(flt.jenis) dataQuery = dataQuery.eq('jenis', flt.jenis)
    if(flt.user)  dataQuery = dataQuery.eq('created_by_name', flt.user)
    if(flt.acc)   dataQuery = dataQuery.or(`src_account_id.eq.${flt.acc},dst_account_id.eq.${flt.acc}`)

    const { data, error } = await dataQuery.order('created_at',{ascending:false}).range(page*pageSize,(page+1)*pageSize-1)
    if(error){
      $('tb').innerHTML = `<tr><td colspan="13" style="color:#991b1b">Gagal memuat riwayat: ${error.message}</td></tr>`
      lastRiwayatRows=[]; updateExportState(); return
    }
    const rows=data||[]; lastRiwayatRows=rows
    if(rows.length===0){
      $('tb').innerHTML = `<tr><td colspan="13" style="color:#64748b">Belum ada transaksi pada tanggal ini.</td></tr>`

      updateExportState(); return
    }

    let i = 1 + page*pageSize
    $('tb').innerHTML = rows.map(r=>{
      const tgl = fmtHuman(r.created_at)
      const user = r.created_by_name || '-'
      const src = r.src_account_name || '-'
      const dst = r.dst_account_name || ''
      const sumberDana = dst ? `${src} ‚Üí ${dst}` : src
      const saldoAwalCell  = saldoBlock(r.src_account_name, r.src_saldo_awal,  r.dst_account_name, r.dst_saldo_awal)
      const saldoAkhirCell = saldoBlock(r.src_account_name, r.src_saldo_akhir, r.dst_account_name, r.dst_saldo_akhir)

      return `<tr data-id="${r.id}">
        <td>${i++}</td>
        <td>(<span style="color:#1d4ed8">${user}</span>, ${tgl})</td>
        <td><code>${r.id_trx || r.id}</code></td>
        <td>${sumberDana}</td>
        <td style="text-transform:capitalize">${r.jenis}</td>
        <td>${saldoAwalCell}</td>
        <td>${fmtNum(r.nominal || 0)}</td>
        <td>${r.admin_dalam ? fmtNum(r.admin_dalam) : '-'}</td>
        <td>${r.admin_luar ? fmtNum(r.admin_luar) : '-'}</td>
        <td>${r.fee_bank ? fmtNum(r.fee_bank) : '-'}</td>
        <td>${saldoAkhirCell}</td>
        <td>${r.note || '-'}</td>
        <td>
          <button class="btn-sm btn-ghost" data-act="edit" title="Edit">‚úèÔ∏è</button>
          <button class="btn-sm btn-danger" data-act="del" title="Hapus">üóëÔ∏è</button>
        </td>
      </tr>`
    }).join('')

    updateExportState()
  }

  $('btnPrev').onclick=async()=>{ if(page>0){ page--; showLoading(true,'Memuat halaman sebelumnya'); await loadRiwayat(); showLoading(false) } }
  $('btnNext').onclick=async()=>{ if((page+1)*pageSize < totalRows){ page++; showLoading(true,'Memuat halaman berikutnya'); await loadRiwayat(); showLoading(false) } }

  // Modal jenis
  document.getElementById('btnTambah').onclick=()=>$('modalJenis').classList.add('show')
  $('xJenis').onclick=()=>$('modalJenis').classList.remove('show')
  document.querySelectorAll('#modalJenis [data-pilih]').forEach(b=>b.addEventListener('click',()=>{ const j=b.getAttribute('data-pilih'); $('modalJenis').classList.remove('show'); setupForm(j); $('modalForm').classList.add('show') }))

  // Modal form
  $('xForm').onclick=$('batalForm').onclick=()=>{ $('modalForm').classList.remove('show'); editMode=false; editId=null; }

  // Helpers form
  function fillSelect(sel, items){ sel.innerHTML=(items||[]).map(i=>`<option value="${i.id}">${i.name}</option>`).join('') || '<option value="">(Tidak ada opsi)</option>' }
  const findLaci = ()=> {
  const all = (cacheAcc.cash||[]);
  return all.find(a=>/laci|cash/i.test(a.name||'')) || all[0] || null;
}

  
  



async function setupForm(jenis){
  try {
    if ((!cacheAcc.cash?.length || !cacheAcc.rekening?.length || !cacheAcc.server_pulsa?.length) && typeof loadAccounts === 'function') {
      await loadAccounts();
    }

    $('dlgTitle').textContent = ({
      transfer: 'üí∏ Form TRANSFER',
      tarik: 'üèß Form TARIK',
      jasa: '‚öôÔ∏è Form JASA',
      pulsa: 'üì± Form PULSA',
      fee_brilink: 'üè¶ Form FEE BRILINK'
    }[jenis] || ('Form ' + (jenis||'').toUpperCase()));

    
    
    // v33: dynamic accent + data-jenis attribute for CSS targeting
    try {
      const accentColors = {
        tarik: '#4CAF50',
        transfer: '#2196F3',
        pulsa: '#9C27B0',
        'fee brilink': '#FFC107',
        jasa: '#607D8B'
      };
      const color = accentColors[jenis] || '#2196F3';
      document.documentElement.style.setProperty('--accent', color);
      const modalEl = document.getElementById('modalForm');
      if (modalEl) modalEl.setAttribute('data-jenis', String(jenis).toLowerCase());
    } catch (_) {}
// v25: dynamic accent color per jenis
    try {
      const accentColors = {
        tarik: '#4CAF50',
        transfer: '#2196F3',
        pulsa: '#9C27B0',
        fee_brilink: '#FFC107',
        jasa: '#607D8B'
      };
      const color = accentColors[jenis] || '#2196F3';
      document.documentElement.style.setProperty('--accent', color);
    } catch (_) {}
$('f_jenis').value = jenis;
    $('f_branch').value = viewBranch;

    ['f_nom','f_admin_dalam','f_admin_luar','f_admin_luar_only','f_fee_bank','f_ket','f_modal','f_jual']
      .forEach(id => { const el = $(id); if (el) el.value = ''; });

    const sumber = $('f_sumber');
    const terima = $('f_terima');
    const laci = (cacheAcc.cash || []).find(a => /laci|cash/i.test(a.name||'')) || (cacheAcc.cash||[])[0] || null;

    // Reset default
    $('rowSumber').style.display = 'grid';
    $('rowNominal').style.display = 'none';
    $('rowAdminDua').style.display = 'none';
    $('rowAdminLuarOnly').style.display = 'none';
    $('rowFeeBank').style.display = 'none';
    $('rowPulsa').style.display = 'none';
    $('labelNominal').textContent = 'Nominal (Rp)';
    sumber.innerHTML = '<option value="">(Pilih akun sumber)</option>';
    terima.innerHTML = '<option value="">(Pilih akun tujuan)</option>';
    if (sumber) sumber.disabled = false;
    if (terima) terima.disabled = false;
    document.querySelectorAll('#rowSumber div').forEach(d => d.style.display = '');

    // === TRANSFER ===
    if (jenis === 'transfer') {
      const sumberList = [...(cacheAcc.rekening||[]), ...(cacheAcc.server_pulsa||[])];
      fillSelect(sumber, sumberList);
      if (laci) {
        terima.innerHTML = `<option value="${laci.id}">${laci.name}</option>`;
        terima.disabled = true;
      }
      $('rowNominal').style.display = 'grid';
      $('rowAdminDua').style.display = 'grid';
      const adDalam = document.querySelector('#rowAdminDua div:first-child');
      if (adDalam) adDalam.style.display = 'none';
      $('rowFeeBank').style.display = 'grid';
    }
    // === TARIK ===
    else if (jenis === 'tarik') {
      fillSelect(sumber, (cacheAcc.cash||[]));
      const dstList = [...(cacheAcc.rekening||[]), ...(cacheAcc.server_pulsa||[])];
      fillSelect(terima, dstList);
      $('rowNominal').style.display = 'grid';
      $('rowAdminDua').style.display = 'grid';
      // ‚úÖ Pastikan kedua kolom Admin Dalam & Admin Luar muncul
      const adDalam = document.querySelector('#rowAdminDua div:first-child');
      const adLuar  = document.querySelector('#rowAdminDua div:last-child');
      if (adDalam) adDalam.style.display = '';
      if (adLuar)  adLuar.style.display = '';
    }
    // === JASA ===
    else if (jenis === 'jasa') {
      $('rowSumber').style.display = 'none';
      $('rowNominal').style.display = 'none';
      $('rowAdminLuarOnly').style.display = 'grid';
      if (laci) {
        terima.innerHTML = `<option value="${laci.id}">${laci.name}</option>`;
        terima.disabled = true;
      }
    }
    // === PULSA ===
    else if (jenis === 'pulsa') {
      fillSelect(sumber, (cacheAcc.server_pulsa||[]));
      if (laci) {
        terima.innerHTML = `<option value="${laci.id}">${laci.name}</option>`;
        terima.disabled = true;
      }
      $('rowPulsa').style.display = 'grid';
    }
    // === FEE BRILINK ===
    else if (jenis === 'fee_brilink') {
      $('rowSumber').style.display = 'grid';
      const srcField = document.querySelector('#rowSumber div:first-child');
      if (srcField) srcField.style.display = 'none';
      const dstField = document.querySelector('#rowSumber div:last-child');
      if (dstField) dstField.style.display = '';
      fillSelect(terima, (cacheAcc.rekening || []));
      terima.disabled = false;
      $('rowNominal').style.display = 'grid';
      $('labelNominal').textContent = 'Nominal Fee (Rp)';
    }

  } catch (e) {
    console.error('setupForm error:', e);
    const box = $('msgErr');
    if (box) {
      box.style.display = 'block';
      box.textContent = 'Gagal membuka form: ' + (e && e.message ? e.message : e);
    }
  }
}





  // Eksklusif admin dalam/luar untuk TARIK
  $('f_admin_dalam').addEventListener('input',()=>{ if(parseNum($('f_admin_dalam').value)>0) $('f_admin_luar').value='' })
  $('f_admin_luar').addEventListener('input',()=>{ if(parseNum($('f_admin_luar').value)>0) $('f_admin_dalam').value='' })

  // CRUD (edit/hapus)
  document.addEventListener('click', async (e)=>{
    const actBtn = e.target.closest('button[data-act]')
    if(!actBtn) return
    const tr = actBtn.closest('tr[data-id]'); const id = tr?.getAttribute('data-id'); const act = actBtn.getAttribute('data-act')
    if(act==='del'){
      if(!confirm('Hapus transaksi ini?')) return
      const { error } = await supabase.from('transactions').delete().eq('id', id)
      if(error) return alert('Gagal hapus: '+error.message)
      await refreshByRange()
    }else if(act==='edit'){
      const row = (lastRiwayatRows||[]).find(r=>r.id===id); if(!row) return alert('Data tidak ditemukan')
      editMode=true; editId=id
      setupForm(row.jenis)
      $('f_jenis').value=row.jenis; $('f_branch').value=row.branch_code
      if(row.src_account_id) $('f_sumber').value=row.src_account_id
      if(row.dst_account_id) $('f_terima').value=row.dst_account_id
      $('f_nom').value=fmtNum(row.nominal||0); $('f_admin_dalam').value=fmtNum(row.admin_dalam||0); $('f_admin_luar').value=fmtNum(row.admin_luar||0); $('f_fee_bank').value=fmtNum(row.fee_bank||0); $('f_ket').value=row.note||''
      if(row.jenis==='pulsa'){ $('f_modal').value=fmtNum(row.nominal||0); $('f_jual').value=fmtNum((row.nominal||0)+(row.admin_luar||0)) }
      if(row.jenis==='jasa'){ $('f_admin_luar_only').value=fmtNum(row.admin_luar||0) }
      if(row.jenis==='fee_brilink'){  }
      $('modalForm').classList.add('show')
    }
  })

  // Simpan (insert/update)
  
  $('simpanForm').onclick = async ()=>{
    const jenis=$('f_jenis').value, branch=viewBranch, sumber=$('f_sumber').value||null, terima=$('f_terima').value||null, note=$('f_ket').value.trim()
    const findLaci = ()=> {
  const all = (cacheAcc.cash||[]);
  return all.find(a=>/laci|cash/i.test(a.name||'')) || all[0] || null;
}
    try{
      if(!note) throw new Error('Keterangan wajib diisi (mis. No HP / No Ref).')
      const laci=findLaci()
      let row={ id: genIdTrx(), branch_code:branch, jenis, src_account_id:null, dst_account_id:null, nominal:0, admin_dalam:0, admin_luar:0, fee_bank:0, note }

      if(jenis==='transfer'){
        if(!sumber) throw new Error('Sumber Dana (rekening/server) wajib dipilih.')
        if(!laci) throw new Error('Tidak ditemukan akun Laci Tunai.')
        row.src_account_id=sumber; row.dst_account_id=laci.id
        const nominal=parseNum($('f_nom').value), al=parseNum($('f_admin_luar_only').value), fb=parseNum($('f_fee_bank').value)
        if(nominal<=0) throw new Error('Nominal harus > 0.')
        row.nominal=nominal; row.admin_luar=al>0?al:0; row.fee_bank=fb>0?fb:0; row.admin_dalam=0
      }
      // v35p10-patch-start
// === v35p30: Tarik Tunai Fee Logic Fix ===
// Admin Dalam ‚Üí fee masuk ke akun BANK (terima dana), +profit
// Admin Luar  ‚Üí fee masuk ke LACI TUNAI, +profit
else if (jenis==='tarik'){
  if(!terima) throw new Error('Terima Dana wajib dipilih.');
  if(!laci) throw new Error('Tidak ditemukan akun Laci Tunai.');

  const nominal = parseNum($('f_nom').value);
  const ad = parseNum($('f_admin_dalam').value);
  const al = parseNum($('f_admin_luar').value);

  if (nominal <= 0) throw new Error('Nominal harus > 0.');

  // Transaksi utama: Laci ‚Üí Bank (nominal pokok)
  row.src_account_id = laci.id;
  row.dst_account_id = terima;
  row.nominal = nominal;
  row.admin_dalam = ad > 0 ? ad : 0;
  row.admin_luar  = al > 0 ? al : 0;
  row.fee_bank    = 0;

  // --- Mutasi tambahan untuk fee ---
  // 1) Admin Dalam: fee menambah saldo akun BANK (terima dana)
  if (ad > 0 && typeof mutasiArray !== 'undefined') {
    mutasiArray.push({
      jenis: 'Tambah',
      account: terima,
      nominal: ad,
      note: 'Fee Admin Dalam (Tarik Tunai)'
    });
  }

  // 2) Admin Luar: fee menambah saldo Laci Tunai
  if (al > 0 && typeof mutasiArray !== 'undefined') {
    mutasiArray.push({
      jenis: 'Tambah',
      account: laci.id,
      nominal: al,
      note: 'Fee Admin Luar (Tarik Tunai)'
    });
  }

  // Profit bertambah dari kedua fee
  if (typeof totalProfit !== 'undefined') {
    
totalProfit += (ad + al);

// === v35p33: Mutasi saldo fee admin ===
if (ad > 0 && typeof supabase !== 'undefined') {
  
await supabase.from('mutasi_saldo').insert({
    branch_code: branch,
    jenis: 'Tambah',
    account_id: terima,
    nominal: ad,
    note: 'Fee Admin Dalam (Tarik Tunai)'
  });
if (typeof loadKPISaldo === 'function') await refreshSaldoAkun();

}

if (al > 0 && typeof supabase !== 'undefined') {
  
await supabase.from('mutasi_saldo').insert({
    branch_code: branch,
    jenis: 'Tambah',
    account_id: laci.id,
    nominal: al,
    note: 'Fee Admin Luar (Tarik Tunai)'
  });
if (typeof loadKPISaldo === 'function') await refreshSaldoAkun();

}

  }
}
// v35p10-patch-end

else if(jenis==='jasa'){
  if(laci){ fillSelect(terima,[laci]); terima.disabled=true }
  $('rowNominal').style.display='none'       // sembunyikan kolom nominal
  $('rowAdminLuarOnly').style.display='grid' // tampilkan hanya admin luar
}
      else if(jenis==='pulsa'){
        if(!sumber) throw new Error('Sumber Dana (rekening/server) wajib dipilih.')
        if(!laci) throw new Error('Tidak ditemukan akun Laci Tunai.')
        const modal=parseNum($('f_modal').value), jual=parseNum($('f_jual').value)
        if(modal<=0) throw new Error('Modal harus > 0.')
        if(jual<modal) throw new Error('Jual tidak boleh kurang dari Modal.')
        const margin=Math.max(jual-modal,0)
        row.src_account_id=sumber; row.dst_account_id=laci.id
        row.nominal=modal; row.admin_dalam=0; row.admin_luar=margin; row.fee_bank=0
      }
      else if(jenis==='fee_brilink'){
        if(!terima) throw new Error('Terima Dana wajib dipilih.')
        row.src_account_id=null; row.dst_account_id=terima
        const fee=parseNum($('f_nom').value)
        if(fee<=0) throw new Error('Nominal Fee harus > 0.')
        row.nominal=0; row.admin_dalam=fee; row.admin_luar=0; row.fee_bank=0
      }

      const { error } = await supabase.from('transactions').insert(row)
      if(error) throw error
      alert('Berhasil disimpan!')
      $('modalForm').classList.remove('show'); editMode=false; editId=null
      await refreshByRange()
    }catch(e){ alert('Gagal: '+(e.message||e)) }
  }


  // Branch bar
  async function initBranchBar(){
    const sel=$('branchTopSelect'), lbl=$('bbNowName')
    const { data:{ session } } = await supabase.auth.getSession()
    let role=(localStorage.getItem('user_role')||'').toLowerCase(), prof=null
    if(session){
      const { data } = await supabase.from('profiles').select('role,branch_code').eq('id',session.user.id).maybeSingle()
      prof=data||null; if(prof?.role) role=prof.role.toLowerCase()
    }
    if(!role) role='kasir'

    let list=[]
    if(role==='owner'){
      const { data } = await supabase.from('branches').select('code,name').order('name')
      list=(data||[]).map(b=>({code:b.code,name:b.name||b.code}))
    } else {
      list = prof?.branch_code ? [{code:prof.branch_code,name:prof.branch_code}] : []
    }

    sel.innerHTML='<option value="">-- Pilih Toko --</option>'+list.map(b=>`<option value="${b.code}">${b.name}</option>`).join('')

    let active
    if(role==='owner'){
      const saved=getActive()
      active = saved.code ? saved : (list[0] || {code:'',name:''})
    }else{
      active = list[0] || {code:'',name:''}
      setActive(active.code, active.name)
      sel.style.display='none'
    }

    if(active.code){
      sel.value=active.code
      lbl.textContent=active.name||active.code
      viewBranch=active.code
    } else { lbl.textContent='-' }

    sel.onchange = async ()=>{
      if(role!=='owner') return
      const code = sel.value
      const name = sel.options[sel.selectedIndex]?.text || code
      if(!code) return
      setActive(code, name); lbl.textContent = name; viewBranch = code
      showLoading(true,'Mengganti cabang & memuat data')
      await loadAccounts(); await populateFilterOptions(); await refreshByRange()
      showLoading(false)
    }
  }

  
  function normPath(u){ return (u||'').toLowerCase().split('/').pop().replace(/[#?].*$/,'') || 'index.html' }
  function isActive(link){
    const current = normPath(location.pathname), target = normPath(link)
    const EQUIV = new Set(['das.html','dashboard.html','index.html',''])
    const curSet = EQUIV.has(current) ? EQUIV : new Set([current])
    const tgtSet = EQUIV.has(target)  ? EQUIV : new Set([target])
    for(const v of curSet){ if(tgtSet.has(v)) return true } return false
  }
  async function initSidebar(){
    const roleLS=(localStorage.getItem("user_role")||gRole||"kasir").toLowerCase();
    const menuModel=[
      { type:"item", label:"Dashboard", icon:"üìä", link:"./dashboard.html" },
      { type:"item", label:"Transaksi Mini ATM", icon:"üßÆ", link:"./transaksi-mini-atm.html" },
      { type:"group", key:"grp_master", title:"Master Data", icon:"üìÇ",
        items:[ {type:"item",label:"Master Saldo Akun",icon:"üí∞",link:"./master-saldo-akun.html"},
                {type:"item",label:"Mutasi Saldo",icon:"üîÑ",link:"./mutasi-saldo.html"},
                {type:"item",label:"Saldo Real",icon:"üìë",link:"./saldo-real.html"} ] },
      { type:"group", key:"grp_laporan", title:"Laporan", icon:"üìò",
        items:[ {type:"item",label:"Laporan MiniLink",icon:"üìò",link:"./laporan.html"} ]},
      { type:"group", key:"grp_pengaturan", title:"Pengaturan", icon:"‚öôÔ∏è",
        items:[ {type:"item",label:"Manajemen Pengguna",icon:"üë•",link:"./manajemen-pengguna.html",ownerOnly:true},
                {type:"item",label:"Hak Akses",icon:"üîë",link:"./hak-akses.html",ownerOnly:true} ] }
    ];
    function getGroupState(k){ const st=JSON.parse(localStorage.getItem("sidebar_groups_state")||"{}"); return st[k]!==false }
    function setGroupState(k,o){ const st=JSON.parse(localStorage.getItem("sidebar_groups_state")||"{}"); st[k]=!!o; localStorage.setItem("sidebar_groups_state",JSON.stringify(st)) }

    const nav=document.getElementById("menuList"); nav.innerHTML="";
    menuModel.forEach(n=>{
      if(n.ownerOnly && roleLS!=="owner") return;
      if(n.type==="item"){
        const a=document.createElement("a"); a.href=n.link; a.textContent=`${n.icon} ${n.label}`;
        if(isActive(n.link)) a.classList.add("active"); nav.appendChild(a);
      }else{
        const g=document.createElement("div"); g.className="group"; if(!getGroupState(n.key)) g.classList.add("collapsed");
        const h=document.createElement("div"); h.className="group-header";
        h.innerHTML=`<div>${n.icon} ${n.title}</div><div class="chev">‚ñæ</div>`;
        h.addEventListener("click",()=>{ const open=!g.classList.contains("collapsed"); if(open) g.classList.add("collapsed"); else g.classList.remove("collapsed"); setGroupState(n.key,!open) });
        const b=document.createElement("div"); b.className="group-body";
        (n.items||[]).forEach(it=>{
          if(it.ownerOnly && roleLS!=="owner") return;
          const a=document.createElement("a"); a.href=it.link; a.textContent=`${it.icon} ${it.label}`;
          if(isActive(it.link)) a.classList.add("active"); b.appendChild(a);
        });
        g.appendChild(h); g.appendChild(b); nav.appendChild(g);
      }
    })

    document.getElementById('lnk-logout-visual').addEventListener('click', async (e)=>{
      e.preventDefault(); await supabase.auth.signOut();
      localStorage.removeItem('current_branch_code'); localStorage.removeItem('current_branch_name');
      location.href='login.html';
    })
  }

  // Hamburger + overlay
  const sidebarEl = document.getElementById('sidebar');
  const overlayEl = document.createElement('div'); overlayEl.className='overlay';
  Object.assign(overlayEl.style,{position:'fixed',inset:'0',background:'rgba(2,6,23,.45)',opacity:'0',pointerEvents:'none',transition:'opacity .25s ease',zIndex:'9999'});
  document.body.appendChild(overlayEl);
  const btnHamb = document.getElementById('toggleSidebar');
  function toggleSidebar(open){
    const willOpen = (typeof open==='boolean') ? open : !sidebarEl.classList.contains('open');
    sidebarEl.classList.toggle('open', willOpen);
    overlayEl.style.opacity = willOpen ? '1':'0';
    overlayEl.style.pointerEvents = willOpen ? 'auto':'none';
    document.body.style.overflow = willOpen ? 'hidden':'auto';
    btnHamb?.setAttribute('aria-expanded', String(willOpen));
  }
  btnHamb?.addEventListener('click', ()=> toggleSidebar());
  overlayEl?.addEventListener('click', ()=> toggleSidebar(false));
  window.addEventListener('keyup', (e)=>{ if(e.key==='Escape') toggleSidebar(false); });

  document.addEventListener('click', (e)=>{
    const a = e.target.closest('.sidebar a'); if(!a) return;
    document.querySelectorAll('.sidebar .nav a.active').forEach(el=>el.classList.remove('active'));
    a.classList.add('active'); setTimeout(()=>toggleSidebar(false),120);
  });

  // Start
  boot()
</script>
<div id="toast" class="toast"></div>

<script id="v7-compact-js">
// === v7 Floating Labels helpers ===
function v7_markFilled(container){
  const inp = container.querySelector('input, select, textarea');
  if(!inp) return;
  if((inp.tagName==='SELECT' && inp.value) || (inp.value && String(inp.value).trim()!=='')){
    container.classList.add('filled');
  }else{
    container.classList.remove('filled');
  }
}
function v7_applyFloating(){
  // Each field container is .dlg-bd .row > div
  document.querySelectorAll('#modalForm .dlg-bd .row > div').forEach(div=>{
    const inp = div.querySelector('input, select, textarea');
    if(!inp) return;
    // add placeholder spacer for inputs to enable :placeholder-shown behavior if needed
    if(inp.tagName==='INPUT' && !inp.getAttribute('placeholder')) inp.setAttribute('placeholder',' ');
    // initial state
    v7_markFilled(div);
    // wire events
    ['change','input','blur'].forEach(ev=> inp.addEventListener(ev, ()=>v7_markFilled(div)));
  });
}
// run once on load


document.addEventListener('DOMContentLoaded', () => {
  const dateInput = document.getElementById('fltDate');
  if (dateInput) {
    // Kosongkan dulu agar tidak pakai cache browser
    dateInput.value = '';
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, '0');
    const dd = String(today.getDate()).padStart(2, '0');
    dateInput.value = `${yyyy}-${mm}-${dd}`; // set ulang ke tanggal hari ini
  }

  }

  v7_applyFloating();
});
</script>



<script>
(function(){
  // Called after setupForm renders fields
  const initFloating = () => {
    try {
      const modal = document.getElementById('modalForm');
      if (!modal) return;
      const boxes = modal.querySelectorAll('#rowSumber > div, #rowAdminDua > div, #rowPulsa > div, #rowNominal, #rowAdminLuarOnly, #rowFeeBank, .form-group');
      boxes.forEach(box => {
        const lbl = box.querySelector('label');
        const ctrl = box.querySelector('input, select, textarea');
        if (!lbl || !ctrl) return;
        box.classList.add('v26-field');
        if ((ctrl.tagName === 'INPUT' || ctrl.tagName === 'TEXTAREA') && !ctrl.hasAttribute('placeholder')) {
          ctrl.setAttribute('placeholder', ' ');
        }
        if (ctrl.tagName === 'SELECT') {
          const setHasValue = () => {
            if (ctrl.value && ctrl.value !== '') ctrl.setAttribute('data-hasvalue', '1');
            else ctrl.setAttribute('data-hasvalue', '0');
          };
          ctrl.addEventListener('change', setHasValue);
          setHasValue();
        }
      });
    } catch (e) {
      console.warn('v26 floating init error:', e);
    }
  };

  // Expose/override hook used by previous versions
  window.v7_applyFloating = initFloating;

  // Also run once on DOM ready (in case modal initially open)
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initFloating);
  } else {
    initFloating();
  }
})();
</script>

<script>

(function(){
  function isVisible(el){
    const s = getComputedStyle(el);
    return s.display !== 'none' && s.visibility !== 'hidden' && el.offsetParent !== null;
  }
  function markInvalid(i,msg){
    i.classList.add('v34-invalid','v34-shake');
    let l=i.previousElementSibling;
    if(l && l.tagName.toLowerCase()==='label') l.classList.add('v34-label-invalid');
    let e=i.parentElement.querySelector('.v34-error');
    if(!e){
      e=document.createElement('div');
      e.className='v34-error';
      i.parentElement.appendChild(e);
    }
    e.textContent=msg||'Wajib diisi';
    e.classList.add('show');
    setTimeout(()=>i.classList.remove('v34-shake'),300);
  }
  function clearInvalid(i){
    i.classList.remove('v34-invalid');
    let l=i.previousElementSibling;
    if(l) l.classList.remove('v34-label-invalid');
    let e=i.parentElement.querySelector('.v34-error');
    if(e) e.classList.remove('show');
  }
  function isRequired(i){
    return i.hasAttribute('required') || i.dataset.required==='true';
  }
  function isEmpty(i){
    if(i.disabled || i.readOnly || !isVisible(i)) return false;
    return (i.value || '').trim() === '';
  }
  document.addEventListener('submit', e => {
    const f = e.target;
    if(!f.matches('[data-validate="true"]')) return;
    let inv = null;
    f.querySelectorAll('input,select,textarea').forEach(i => {
      if(isRequired(i) && isEmpty(i)){
        markInvalid(i);
        if(!inv) inv = i;
      } else clearInvalid(i);
    });
    if(inv){
      e.preventDefault();
      inv.focus();
      f.classList.add('v34-shake');
      setTimeout(()=>f.classList.remove('v34-shake'),300);
    }
  });
  document.addEventListener('input', e => {
    const i = e.target;
    if(isRequired(i) && !isEmpty(i)) clearInvalid(i);
  });
})();
</script>
<script>

function showSuccessPulse(form) {
  if (!form) return;
  form.classList.add('success-pulse');
  let icon = form.querySelector('.success-icon');
  if (!icon) {
    icon = document.createElement('div');
    icon.className = 'success-icon';
    icon.textContent = '‚úÖ';
    form.appendChild(icon);
  }
  icon.classList.add('show');
  setTimeout(() => {
    icon.classList.remove('show');
    form.classList.remove('success-pulse');
  }, 800);
}
</script>


<script>
(function(){
  if (typeof window.$ === 'undefined') window.$ = (sel)=>document.querySelector(sel);

  if (typeof window.showToast !== 'function') {
    window.showToast = function(msg, type){
      try{
        const el = document.createElement('div');
        el.textContent = msg;
        el.style.position = 'fixed';
        el.style.left = '50%';
        el.style.bottom = '24px';
        el.style.transform = 'translateX(-50%)';
        el.style.padding = '10px 16px';
        el.style.borderRadius = '8px';
        el.style.color = '#fff';
        el.style.zIndex = 99999;
        el.style.background = (type==='success'?'#16a34a': type==='error'?'#dc2626':'#2563eb');
        el.style.boxShadow = '0 6px 24px rgba(0,0,0,.18)';
        document.body.appendChild(el);
        setTimeout(()=>{ el.remove(); }, 2200);
      }catch(_){ alert(msg); }
    };
  }

  if (window.supabase && typeof window.supabase.from === 'function') {
    const origFrom = window.supabase.from.bind(window.supabase);
    window.supabase.from = function(tableName){
      const lower = String(tableName).toLowerCase();
      const query = origFrom(tableName);

       else {
              const msg = res && res.error ? (res.error.message || 'Gagal menyimpan transaksi') : 'Gagal menyimpan transaksi';
              window.showToast('‚ùå ' + msg, 'error');
            }
            return res;
          }catch(err){
            window.showToast('‚ùå ' + (err && err.message ? err.message : 'Gagal menyimpan transaksi'), 'error');
            throw err;
          }
        };
      }

      return query;
    };
    console.log('‚úÖ v35p23-clean aktif (blok mutasi_saldo, toast transactions)');
  }
})();
</script>




<script>

(function(){
  const FEE_KEYS = ['fee brilink','fee_brilink','fee','brilink'];
  const isFee = (j)=> FEE_KEYS.includes(String(j||'').toLowerCase().trim());

  function pickDstAccountId(){
    const candidates = [
      '#dstAccountSelect',
      '#dstAccount',
      '[name="dst_account_id"]',
      'select[name*="dst"]',
      'select[id*="dst"]',
      'select[id*="tujuan"]',
      'select[name*="tujuan"]'
    ];
    for (const sel of candidates){
      const el = document.querySelector(sel);
      if (el && el.value) return el.value;
    }
    return null;
  }

  function pickNominal(){
    const candidates = [
      '#nominalInput',
      '[name="nominal"]',
      'input[id*="nominal" i]',
      'input[name*="nominal" i]',
      'input[id*="fee" i]',
      'input[name*="fee" i]'
    ];
    for (const sel of candidates){
      const el = document.querySelector(sel);
      if (el && String(el.value).trim().length){
        const n = parseFloat(String(el.value).replace(/[^0-9.]/g,''));
        if (!Number.isNaN(n)) return n;
      }
    }
    return null;
  }

  function normalizeOne(o){
    if (!o || typeof o !== 'object') return o;
    const jenis = o.jenis || o.jenis_transaksi || o.type;
    if (isFee(jenis)){
      if (!o.dst_account_id) o.dst_account_id = pickDstAccountId();
      if (!o.nominal || Number(o.nominal) === 0){
        const n = pickNominal();
        if (n != null) o.nominal = n;
      }
      if (!('src_account_id' in o)) o.src_account_id = null;
    }
    return o;
  }

  // Guard: patch only if supabase client exists
  if (window.supabase && typeof window.supabase.from === 'function'){
    const origFrom = window.supabase.from.bind(window.supabase);
    window.supabase.from = function(tableName){
      const query = origFrom(tableName);
      if (String(tableName).toLowerCase() === 'transactions' && typeof query.insert === 'function'){
        const origInsert = query.insert.bind(query);
        query.insert = async function(payload){
          try{
            if (Array.isArray(payload)) payload = payload.map(normalizeOne);
            else payload = normalizeOne(payload);
          }catch(e){ console.warn('v35p25 normalize error:', e); }
          const res = await origInsert(payload);
          try{
            if (res && !res.error){
              if (typeof window.showToast === 'function') window.showToast('‚úÖ Transaksi berhasil disimpan', 'success');
            } else {
              const msg = (res && res.error && res.error.message) ? res.error.message : 'Gagal menyimpan transaksi';
              if (typeof window.showToast === 'function') window.showToast('‚ùå ' + msg, 'error');
            }
          }catch(_e){}
          return res;
        };
      }
      return query;
    };
    console.log('‚úÖ v35p25-stable-fix active: transactions.insert normalized for Fee Brilink');
  } else {
    console.warn('v35p25-stable-fix: supabase client not found.');
  }
})();
</script>




<div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true" style="display:none">OK</div>
<script>
// === v35p26-fix-display.js ===
function formatRupiah(v){
  try {
    if (v === null || v === undefined) return "Rp 0";
    const num = typeof v === 'number' ? v : parseFloat(String(v).replace(/[^0-9.-]/g,'')) || 0;
    return new Intl.NumberFormat('id-ID', { style:'currency', currency:'IDR', maximumFractionDigits:0 }).format(num);
  } catch(e){ return 'Rp 0'; }
}
function showToast(msg, type='success'){
  const el = document.getElementById('toast');
  if(!el) return;
  el.textContent = msg || 'Berhasil';
  el.classList.remove('error');
  if (type === 'error') el.classList.add('error');
  el.style.display = 'block';
  requestAnimationFrame(()=> el.classList.add('show'));
  setTimeout(()=>{
    el.classList.remove('show');
    setTimeout(()=>{ el.style.display = 'none'; }, 300);
  }, 2600);
}
function getFilters(){
  return {
    date: document.getElementById('fltDate'),
    user: document.getElementById('fltUser'),
    jenis: document.getElementById('fltJenis'),
    rek:  document.getElementById('fltRek'),
    total: document.getElementById('totalTransaksi'),
    tbody: document.getElementById('tb')
  };
}
async function loadTransactions(){
  const F = getFilters();
  if (!F.tbody) return console.warn('[v35p26] tbody#tb tidak ditemukan');
  if (typeof supabase === 'undefined') {
    console.error('[v35p26] Supabase client tidak tersedia');
    F.tbody.innerHTML = '<tr><td colspan="13" style="color:#b91c1c;font-weight:700">Supabase client tidak ditemukan. Pastikan inisialisasi sudah benar.</td></tr>';
    return;
  }
  let query = supabase.from('transactions').select('*').order('created_at', { ascending: false });
  const dateVal = F.date && F.date.value ? F.date.value : '';
  const userVal = F.user && F.user.value ? F.user.value : '';
  const jenisVal = F.jenis && F.jenis.value ? F.jenis.value : '';
  const rekVal  = F.rek && F.rek.value ? F.rek.value : '';
  try {
    if (dateVal) {
      const start = new Date(dateVal + 'T00:00:00');
      const end   = new Date(dateVal + 'T23:59:59');
      query = query.gte('created_at', start.toISOString()).lte('created_at', end.toISOString());
    }
    if (userVal)  query = query.eq('user', userVal).or(`user_name.eq.${userVal}`);
    if (jenisVal) query = query.ilike('jenis', jenisVal.replace('_',' ').replace('-',' '));
    if (rekVal)   query = query.or(`src_account_id.eq.${rekVal},src_account.eq.${rekVal},src.eq.${rekVal}`);
  } catch (e) { console.warn('[v35p26] Filter tidak diterapkan penuh:', e); }
  const { data, error } = await query;
  if (error) {
    console.error('[v35p26] Gagal load transaksi:', error);
    F.tbody.innerHTML = '<tr><td colspan="13" style="color:#b91c1c;font-weight:700">Gagal memuat transaksi: ' + (error.message||'') + '</td></tr>';
    return;
  }
  F.tbody.innerHTML = '';
  const rows = Array.isArray(data) ? data : [];
  if (F.total) F.total.textContent = 'Jumlah Total Transaksi = ' + rows.length;
  rows.forEach((trx, idx) => {
    const tr = document.createElement('tr');
    const userDisplay = (trx.user_name || trx.user || '-') + '<br><small>' + (trx.created_at ? new Date(trx.created_at).toLocaleString('id-ID') : '-') + '</small>';
    const sumber = (trx.src_account || trx.src_account_id || trx.src || '-') + (trx.dst_account ? ' ‚Üí ' + trx.dst_account : '');
    const jenis = (trx.jenis || '-');
    const nominal = formatRupiah(trx.nominal || 0);
    const adminDalam = formatRupiah(trx.admin_dalam || trx.admin_dlm || 0);
    const adminLuar  = formatRupiah(trx.admin_luar || trx.admin_lr || 0);
    const feeBank    = formatRupiah(trx.fee_bank || trx.fee || 0);
    const saldoAwal  = formatRupiah(trx.saldo_awal || 0);
    const saldoAkhir = formatRupiah(trx.saldo_akhir || 0);
    const ket = (trx.note || trx.keterangan || '');
    tr.innerHTML = [
      '<td>' + (idx+1) + '</td>',
      '<td>' + userDisplay + '</td>',
      '<td>' + (trx.id_trx || trx.id || '-') + '</td>',
      '<td>' + sumber + '</td>',
      '<td style="text-transform:uppercase;font-weight:800">' + jenis + '</td>',
      '<td>' + saldoAwal + '</td>',
      '<td>' + nominal + '</td>',
      '<td>' + adminDalam + '</td>',
      '<td>' + adminLuar + '</td>',
      '<td>' + feeBank + '</td>',
      '<td>' + saldoAkhir + '</td>',
      '<td>' + ket + '</td>',
      '<td>-</td>'
    ].join('');
    F.tbody.appendChild(tr);
  });
  if (rows.length === 0) {
    F.tbody.innerHTML = '<tr><td colspan="13" style="text-align:center;color:#475569;padding:10px">Belum ada transaksi untuk filter saat ini.</td></tr>';
  }
}
window.afterInsertSuccess = async function(){
  try {
    if (typeof showToast === 'function') showToast('‚úÖ Transaksi berhasil disimpan & ditampilkan di tabel');
    await loadTransactions();
  } catch (e) { console.error('[v35p26] afterInsertSuccess error:', e); }
};
(function wireCommonSubmit(){
  const btn = document.getElementById('btnSubmit');
  if (!btn) return;
  if (btn.dataset.v35p26wired === '1') return;
  btn.dataset.v35p26wired = '1';
  btn.addEventListener('click', function(){
    setTimeout(()=>{ loadTransactions(); }, 1000);
  }, true);
})();
function wireFilters(){
  const F = getFilters();
  [F.date, F.user, F.jenis, F.rek].forEach(el => {
    if (!el) return;
    el.addEventListener('change', () => loadTransactions());
  });
}
document.addEventListener('DOMContentLoaded', () => {
  wireFilters();
  loadTransactions();
});
</script>



<script>
// === v35p27-fix-fee-balance.js ===
function v35_isFeeJenis(j){
  const s = String(j||'').toLowerCase();
  return s.includes('fee') || s.includes('brilink');
}
async function handleFeeBrilinkUpdate(row){
  try{
    if (!row || !row.dst_account_id) return;
    const nominal = Number(row.nominal||0);
    if (!(nominal>0)) return;
    const { data: acc, error: e1 } = await supabase.from('accounts').select('saldo').eq('id', row.dst_account_id).single();
    if (e1) { console.warn('[v35p27] gagal get saldo tujuan:', e1); return; }
    const saldoLama = Number(acc && acc.saldo || 0);
    const saldoBaru = saldoLama + nominal;
    const { error: e2 } = await supabase.from('accounts').update({ saldo: saldoBaru }).eq('id', row.dst_account_id);
    if (e2) { console.warn('[v35p27] gagal update saldo tujuan:', e2); return; }
    if (typeof showToast === 'function') showToast('Saldo akun tujuan berhasil diperbarui.', 'success');
    if (typeof loadKPISaldo === 'function') { try { await refreshSaldoAkun(); } catch(_){} }
  }catch(err){
    console.error('[v35p27] Exception handleFeeBrilinkUpdate:', err);
  }
}
(function patchInsertForFee(){
  if (!window.supabase || typeof window.supabase.from !== 'function') return;
  const origFrom = window.supabase.from.bind(window.supabase);
  window.supabase.from = function(tableName){
    const q = origFrom(tableName);
    if (String(tableName).toLowerCase() === 'transactions' && typeof q.insert === 'function'){
      const _origInsert = q.insert.bind(q);
      q.insert = async function(payload){
        let feeRows = [];
        try {
          if (Array.isArray(payload)) feeRows = payload.filter(r=>v35_isFeeJenis(r && (r.jenis||r.type||r.jenis_transaksi)));
          else if (payload && v35_isFeeJenis(payload.jenis || payload.type || payload.jenis_transaksi)) feeRows = [payload];
        } catch(_){}
        const res = await _origInsert(payload);
        try {
          if (res && !res.error && feeRows.length){
            for (const r of feeRows){ await handleFeeBrilinkUpdate(r); }
          }
        } catch(e){ console.warn('[v35p27] post-insert fee update warning:', e); }
        try { if (typeof window.afterInsertSuccess === 'function') await window.afterInsertSuccess(); } catch(_){}
        return res;
      };
    }
    return q;
  };
  console.log('‚úÖ v35p27-fix-fee-balance active');
})();
</script>


<script>
// === v35p36: refreshSaldoAkun ===
async function refreshSaldoAkun(){
  try{
    const { data, error } = await supabase.from('accounts').select('*');
    if (error) throw error;
    const wrap = document.getElementById('kpiSaldoWrap');
    if (!wrap) return;
    wrap.innerHTML = data.map(a=>`
      <div class="kpi-card">
        <div class="kpi-title">${a.nama}</div>
        <div class="kpi-value">Rp ${Number(a.saldo||0).toLocaleString('id-ID')}</div>
      </div>`).join('');
    console.log('[v35p36] KPI saldo akun diperbarui');
  }catch(err){
    console.error('[v35p36] Gagal refresh saldo akun:', err);
  }
}
</script>


<!-- v35p37-nopagination: pagination HTML & JS removed; Supabase .range() removed -->
</body>

<style>

.container, .content, .main-wrapper {
  padding-left: 6px !important;
  padding-right: 6px !important;
  margin: 0 auto !important;
}
.card, .kpi-card, .filter-box, .table-wrapper {
  margin: 6px 4px !important;
  padding: 8px 10px !important;
}
@media (max-width: 768px) {
  .container, .content, .main-wrapper {
    padding-left: 4px !important;
    padding-right: 4px !important;
  }
  .card, .kpi-card, .filter-box, .table-wrapper {
    margin: 4px 2px !important;
    padding: 6px 8px !important;
  }
}



.kpi-section,
.kpi-grid,
.kpi-card {
  width: 100% !important;
  max-width: 100% !important;
}
.kpi-section {
  margin-left: 0 !important;
  margin-right: 0 !important;
  padding-left: 0 !important;
  padding-right: 0 !important;
}
@media (min-width: 769px) {
  .container, .main-wrapper, .content {
    padding-left: 12px !important;
    padding-right: 12px !important;
  }
}

</style>


<style>

.main-container {
  width: 100% !important;
  max-width: 100% !important;
  margin: 0 !important;
  padding-left: 0 !important;
  padding-right: 0 !important;
}
.kpi-grid, .kpi-transaksi, .card {
  margin-left: 0 !important;
  margin-right: 0 !important;
  width: 100% !important;
  max-width: 100% !important;
}
@media (max-width: 768px) {
  .main-container {
    padding-left: 0 !important;
    padding-right: 0 !important;
  }
}
</style>


<style>

.branchbar {
  max-width: 97% !important;
  margin: 20 !important;
  padding-left: 20!important;
  padding-right: 20 !important;
  width: 97% !important;
}
</style>

</html>


<style>

.kpi, .kpi-card {
  width: 160px !important;
  height: 80px !important;
  padding: 8px 10px !important;
  border-radius: 10px !important;
  margin: 4px !important;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.kpi:hover, .kpi-card:hover {
  transform: scale(1.03);
  box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
}
.kpi h4, .kpi-card .kpi-title {
  font-size: 12px !important;
  margin-bottom: 4px !important;
}
.kpi .val, .kpi-card .kpi-value {
  font-size: 14px !important;
  font-weight: 600 !important;
}
.kpi-grid {
  display: flex !important;
  flex-wrap: wrap !important;
  gap: 6px !important;
  justify-content: center !important;
}
@media (max-width: 768px) {
  .kpi, .kpi-card {
    width: 130px !important;
    height: 70px !important;
    padding: 6px 8px !important;
  }
  .kpi h4, .kpi-card .kpi-title { font-size: 11px !important; }
  .kpi .val, .kpi-card .kpi-value { font-size: 13px !important; }
}
</style>


<style>
#kpiSaldoWrap {
  display: flex !important;
  flex-wrap: nowrap !important;
  overflow-x: auto !important;
  gap: 8px !important;
  scroll-behavior: smooth !important;
  padding: 8px !important;
  border-radius: 14px !important;
}
#kpiSaldoWrap > .kpi-card {
  flex: 0 0 auto !important;
  min-width: 160px !important;
  max-width: 180px !important;
  height: 70px !important;
  border-radius: 12px !important;
  padding: 8px 10px !important;
  display: flex !important;
  align-items: center !important;
  justify-content: space-between !important;
  background: linear-gradient(180deg, var(--chip1), var(--chip2)) !important;
  color: #fff !important;
  font-size: 13px !important;
  font-weight: 600 !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
  transition: transform 0.2s ease, box-shadow 0.2s ease !important;
}
#kpiSaldoWrap > .kpi-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
}
#kpiSaldoWrap::-webkit-scrollbar {
  height: 6px;
}
#kpiSaldoWrap::-webkit-scrollbar-thumb {
  background-color: rgba(0,0,0,0.2);
  border-radius: 10px;
}
#kpiSaldoWrap::-webkit-scrollbar-track {
  background-color: transparent;
}
@media (max-width: 768px) {
  #kpiSaldoWrap > .kpi-card {
    min-width: 130px !important;
    height: 65px !important;
    font-size: 12px !important;
  }
}
</style>


<style>
#kpiSaldoWrap {
  display: flex !important;
  flex-wrap: nowrap !important;
  justify-content: flex-start !important;
  overflow-x: auto !important;
  gap: 8px !important;
  scroll-behavior: smooth !important;
  padding: 8px !important;
  border-radius: 14px !important;
}
#kpiSaldoWrap > .kpi-card {
  flex: 0 0 auto !important;
  min-width: 160px !important;
  max-width: 180px !important;
  height: 70px !important;
  border-radius: 12px !important;
  padding: 8px 10px !important;
  display: flex !important;
  align-items: center !important;
  justify-content: space-between !important;
  background: linear-gradient(180deg, var(--chip1), var(--chip2)) !important;
  color: #fff !important;
  font-size: 13px !important;
  font-weight: 600 !important;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
  transition: transform 0.2s ease, box-shadow 0.2s ease !important;
}
#kpiSaldoWrap > .kpi-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
}
#kpiSaldoWrap::-webkit-scrollbar {
  height: 6px;
}
#kpiSaldoWrap::-webkit-scrollbar-thumb {
  background-color: rgba(0,0,0,0.2);
  border-radius: 10px;
}
#kpiSaldoWrap::-webkit-scrollbar-track {
  background-color: transparent;
}
@media (max-width: 768px) {
  #kpiSaldoWrap > .kpi-card {
    min-width: 130px !important;
    height: 65px !important;
    font-size: 12px !important;
  }
}
</style>